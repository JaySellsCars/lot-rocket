:root {
  --bg-dark: #05060a;
  --bg-dark-alt: #0c0f17;
  --bg-light: #f5f5f7;
  --bg-light-alt: #ffffff;
  --accent: #ff4b4b;
  --accent-soft: rgba(255, 75, 75, 0.15);
  --border-dark: #252836;
  --border-light: #d0d3dd;
  --text-dark: #f9fafb;
  --text-muted-dark: #9ca3af;
  --text-light: #111827;
  --text-muted-light: #6b7280;
  --card-radius: 18px;
  --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.4);
  --shadow-soft-light: 0 18px 40px rgba(15, 23, 42, 0.18);
  --input-radius: 12px;
  --transition-fast: 0.18s ease-out;
  --font-main: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
}

/* Theme backgrounds */
[data-theme="dark"] body {
  background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
  color: var(--text-dark);
}
[data-theme="light"] body {
  background: radial-gradient(circle at top, #e5e7eb 0, #f9fafb 40%, #e5e7eb 100%);
  color: var(--text-light);
}

*,
*::before,
*::after {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: var(--font-main);
  display: flex;
  align-items: stretch;
  justify-content: center;
  padding: 24px;
}

/* App shell */
.app-shell {
  width: 100%;
  max-width: 1240px;
  border-radius: 26px;
  padding: 20px 22px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  position: relative;
  overflow: hidden;
}

[data-theme="dark"] .app-shell {
  background: radial-gradient(circle at top left, #1f2937 0, #020617 60%);
  box-shadow: var(--shadow-soft);
  border: 1px solid rgba(148, 163, 184, 0.25);
}
[data-theme="light"] .app-shell {
  background: linear-gradient(135deg, #f9fafb, #e5e7eb);
  box-shadow: var(--shadow-soft-light);
  border: 1px solid rgba(148, 163, 184, 0.35);
}

/* Header */
.app-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.title-group {
  display: flex;
  align-items: center;
  gap: 14px;
}

.logo-circle {
  width: 70px;
  height: 70px;
  border-radius: 999px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

[data-theme="dark"] .logo-circle {
  border: 2px solid #ef4444;
  color: #ef4444;
  background: radial-gradient(circle at center, rgba(239, 68, 68, 0.08), transparent 60%);
}
[data-theme="light"] .logo-circle {
  border: 2px solid #b91c1c;
  color: #b91c1c;
  background: #fff;
}

.logo-inner {
  font-weight: 800;
  font-size: 30px;
  line-height: 1;
  position: relative;
  font-family: "Times New Roman", Georgia, serif;
}

.logo-inner span.rocket {
  position: absolute;
  left: 52%;
  top: 32%;
  font-size: 16px;
  transform: translateX(-50%);
}

.logo-text-main {
  font-weight: 700;
  font-size: 18px;
  letter-spacing: 0.12em;
  text-transform: uppercase;
}
.logo-text-sub {
  font-size: 13px;
  opacity: 0.78;
}

/* Header right */
.header-right {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 12px;
}

.chip {
  padding: 5px 10px;
  border-radius: 999px;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}
[data-theme="dark"] .chip {
  background: rgba(15, 23, 42, 0.95);
  border: 1px solid rgba(148, 163, 184, 0.5);
  color: var(--text-muted-dark);
}
[data-theme="light"] .chip {
  background: rgba(255, 255, 255, 0.85);
  border: 1px solid rgba(148, 163, 184, 0.5);
  color: var(--text-muted-light);
}
.chip span.dot {
  width: 6px;
  height: 6px;
  border-radius: 999px;
  background: #22c55e;
  box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15);
}

.theme-toggle {
  border-radius: 999px;
  padding: 6px 10px;
  border: none;
  cursor: pointer;
  font-size: 12px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  transition:
    background var(--transition-fast),
    transform var(--transition-fast),
    box-shadow var(--transition-fast),
    color var(--transition-fast);
}
[data-theme="dark"] .theme-toggle {
  background: rgba(15, 23, 42, 0.95);
  color: var(--text-muted-dark);
  box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.45);
}
[data-theme="light"] .theme-toggle {
  background: rgba(255, 255, 255, 0.95);
  color: var(--text-muted-light);
  box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.5);
}

/* Layout: step1 full width, then step2 + side column */
.layout {
  display: grid;
  grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.75fr);
  grid-auto-rows: auto;
  gap: 16px;
  margin-top: 6px;
}

/* Step 1 spans both columns on first row */
.step1 {
  grid-column: 1 / 3;
}

/* Step 2 is left col of second row */
.step2 {
  grid-column: 1 / 2;
}

/* Side launcher is right col of second row, top aligned with Step 2 */
.side-launcher-wrapper {
  grid-column: 2 / 3;
  align-self: flex-start;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* Card base */
.card {
  border-radius: var(--card-radius);
  padding: 14px 14px 13px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

[data-theme="dark"] .card {
  background: radial-gradient(circle at top left, #111827 0, #020617 60%);
  border: 1px solid rgba(51, 65, 85, 0.9);
}
[data-theme="light"] .card {
  background: rgba(255, 255, 255, 0.92);
  border: 1px solid rgba(148, 163, 184, 0.6);
}

.card-header {
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 8px;
}
.card-title {
  font-size: 14px;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
}
.card-subtitle {
  font-size: 12px;
  opacity: 0.75;
}

.badge {
  font-size: 11px;
  padding: 3px 8px;
  border-radius: 999px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}
[data-theme="dark"] .badge {
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(107, 114, 128, 0.9);
  color: var(--text-muted-dark);
}
[data-theme="light"] .badge {
  background: rgba(249, 250, 251, 0.95);
  border: 1px solid rgba(148, 163, 184, 0.9);
  color: var(--text-muted-light);
}

/* Fields / inputs */
label.field-label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  opacity: 0.8;
  margin-bottom: 4px;
  display: block;
}

.field-group {
  margin-bottom: 8px;
}

.input,
.textarea {
  width: 100%;
  border-radius: var(--input-radius);
  border: 1px solid;
  padding: 7px 9px;
  font-family: var(--font-main);
  font-size: 13px;
  resize: vertical;
  min-height: 34px;
  outline: none;
  transition:
    border-color var(--transition-fast),
    box-shadow var(--transition-fast),
    background var(--transition-fast),
    color var(--transition-fast);
}

.textarea {
  white-space: pre-wrap;
}

[data-theme="dark"] .input,
[data-theme="dark"] .textarea {
  background: rgba(15, 23, 42, 0.95);
  border-color: rgba(55, 65, 81, 0.95);
  color: var(--text-dark);
}
[data-theme="light"] .input,
[data-theme="light"] .textarea {
  background: rgba(249, 250, 251, 0.96);
  border-color: rgba(148, 163, 184, 0.9);
  color: var(--text-light);
}

.input:focus,
.textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.5);
}

/* Buttons */
.button-primary {
  border-radius: 999px;
  padding: 7px 16px;
  border: none;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: auto;
  white-space: nowrap;
  transition:
    transform var(--transition-fast),
    box-shadow var(--transition-fast),
    background var(--transition-fast);
}
[data-theme="dark"] .button-primary {
  background: linear-gradient(135deg, #fb923c, #ef4444);
  color: #fff;
  box-shadow: 0 14px 30px rgba(248, 113, 113, 0.7);
}
[data-theme="light"] .button-primary {
  background: linear-gradient(135deg, #f97316, #dc2626);
  color: #fff;
  box-shadow: 0 12px 26px rgba(239, 68, 68, 0.6);
}
.button-primary:active {
  transform: translateY(1px) scale(0.99);
  box-shadow: none;
}

.button-ghost {
  border-radius: 999px;
  padding: 5px 10px;
  border: 1px solid;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: transparent;
  transition:
    background var(--transition-fast),
    border-color var(--transition-fast),
    color var(--transition-fast);
}
[data-theme="dark"] .button-ghost {
  border-color: rgba(75, 85, 99, 0.85);
  color: var(--text-muted-dark);
}
[data-theme="light"] .button-ghost {
  border-color: rgba(148, 163, 184, 0.9);
  color: var(--text-muted-light);
}
.button-ghost span.icon {
  font-size: 13px;
}

/* Side launcher buttons */
.side-launcher-btn {
  border-radius: 999px;
  padding: 10px 14px;
  border: 1px solid;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
  box-sizing: border-box;
}
[data-theme="dark"] .side-launcher-btn {
  background: rgba(15, 23, 42, 0.96);
  border-color: rgba(148, 163, 184, 0.9);
  color: var(--text-dark);
  box-shadow: 0 14px 30px rgba(0, 0, 0, 0.7);
}
[data-theme="light"] .side-launcher-btn {
  background: rgba(255, 255, 255, 0.96);
  border-color: rgba(148, 163, 184, 0.9);
  color: var(--text-light);
  box-shadow: 0 14px 30px rgba(15, 23, 42, 0.25);
}
.side-launcher-btn .icon {
  font-size: 16px;
}

/* Layout helpers */
.stack-vertical {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.pill-row {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  align-items: center;
}
.pill {
  border-radius: 999px;
  padding: 5px 9px;
  font-size: 11px;
  border: 1px solid;
}
[data-theme="dark"] .pill {
  background: rgba(15, 23, 42, 0.9);
  border-color: rgba(55, 65, 81, 0.9);
  color: var(--text-muted-dark);
}
[data-theme="light"] .pill {
  background: rgba(249, 250, 251, 0.96);
  border-color: rgba(148, 163, 184, 0.9);
  color: var(--text-muted-light);
}

.section-title-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.status-text {
  font-size: 11px;
  opacity: 0.8;
}

.tiny-note {
  font-size: 10px;
  opacity: 0.75;
  margin-top: 4px;
}

/* Photos */
.photos-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 6px;
}
.photo-thumb {
  position: relative;
  border-radius: 10px;
  overflow: hidden;
  cursor: pointer;
  aspect-ratio: 4 / 3;
  border: 1px solid rgba(148, 163, 184, 0.5);
}
.photo-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Social cards */
.social-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}
@media (max-width: 900px) {
  .social-grid {
    grid-template-columns: minmax(0, 1fr);
  }
}

.social-card {
  border-radius: 16px;
  padding: 10px 11px 9px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  border: 1px solid rgba(148, 163, 184, 0.75);
  min-height: 200px;
}
[data-theme="dark"] .social-card {
  background: rgba(15, 23, 42, 0.98);
}
[data-theme="light"] .social-card {
  background: rgba(249, 250, 251, 0.98);
}

.social-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 4px;
  font-size: 12px;
  font-weight: 500;
}
.social-platform {
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.textarea.post-box {
  min-height: 210px;
  max-height: 260px;
  font-size: 13px;
  line-height: 1.35;
}
.textarea.marketplace-box {
  min-height: 230px;
  max-height: 280px;
}
.textarea.script {
  min-height: 160px;
}
.textarea.shotplan {
  min-height: 130px;
}
.textarea.design {
  min-height: 180px;
}

/* Loading dot */
.loading-dot {
  width: 6px;
  height: 6px;
  border-radius: 999px;
  background: var(--accent);
  display: inline-block;
  margin-right: 4px;
  animation: pulse 1s infinite alternate;
}
@keyframes pulse {
  from {
    transform: scale(1);
    opacity: 0.8;
  }
  to {
    transform: scale(1.4);
    opacity: 0.3;
  }
}

/* Hidden utility */
.hidden {
  display: none !important;
}

/* ===========================
   OBJECTION MODAL
   =========================== */

.objection-modal-backdrop {
  position: fixed;
  inset: 0;
  z-index: 70;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(15, 23, 42, 0.78);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
}

.objection-modal-card {
  width: 620px;
  max-width: 96vw;
  max-height: 82vh;
  border-radius: 20px;
  padding: 14px 14px 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
[data-theme="dark"] .objection-modal-card {
  background: radial-gradient(circle at top, #111827 0, #020617 60%);
  border: 1px solid rgba(248, 113, 113, 0.8);
  box-shadow: 0 22px 55px rgba(0, 0, 0, 0.9);
  color: var(--text-dark);
}
[data-theme="light"] .objection-modal-card {
  background: #f9fafb;
  border: 1px solid rgba(248, 113, 113, 0.9);
  box-shadow: 0 22px 55px rgba(15, 23, 42, 0.35);
  color: var(--text-light);
}

.objection-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}
.objection-modal-title-group {
  display: flex;
  flex-direction: column;
  gap: 2px;
}
.objection-modal-tag {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  opacity: 0.8;
}
.objection-modal-title {
  font-size: 14px;
  font-weight: 600;
}
.objection-modal-sub {
  font-size: 11px;
  opacity: 0.8;
}

.objection-modal-close {
  border-radius: 999px;
  border: 1px solid rgba(148, 163, 184, 0.9);
  background: transparent;
  width: 28px;
  height: 28px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 14px;
}

.objection-chat-area {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-top: 4px;
  flex: 1 1 auto;
  min-height: 0;
}

.objection-history {
  flex: 1 1 auto;
  min-height: 160px;
  max-height: 330px;
  border-radius: 12px;
  padding: 8px 9px;
  overflow-y: auto;
  font-size: 12px;
  line-height: 1.4;
  border: 1px solid rgba(148, 163, 184, 0.8);
}
[data-theme="dark"] .objection-history {
  background: rgba(15, 23, 42, 0.96);
}
[data-theme="light"] .objection-history {
  background: rgba(249, 250, 251, 0.98);
}

.objection-bubble {
  margin-bottom: 6px;
  padding: 6px 8px;
  border-radius: 10px;
  white-space: pre-wrap;
}
.objection-bubble.you-label,
.objection-bubble.coach-label {
  font-weight: 600;
  font-size: 11px;
  opacity: 0.8;
  margin-bottom: 2px;
  padding: 0;
}
[data-theme="dark"] .objection-bubble.you {
  background: rgba(37, 99, 235, 0.32);
  border: 1px solid rgba(59, 130, 246, 0.7);
}
[data-theme="light"] .objection-bubble.you {
  background: rgba(191, 219, 254, 0.7);
  border: 1px solid rgba(59, 130, 246, 0.8);
}
[data-theme="dark"] .objection-bubble.coach {
  background: rgba(248, 113, 113, 0.22);
  border: 1px solid rgba(248, 113, 113, 0.8);
}
[data-theme="light"] .objection-bubble.coach {
  background: rgba(254, 226, 226, 0.92);
  border: 1px solid rgba(248, 113, 113, 0.9);
}

.objection-input-row {
  display: flex;
  flex-direction: column;
  gap: 5px;
  margin-top: 4px;
}

.objection-input-box {
  width: 100%;
  border-radius: 12px;
  border: 1px solid rgba(148, 163, 184, 0.9);
  font-family: var(--font-main);
  font-size: 12px;
  padding: 7px 8px;
  resize: vertical;
  min-height: 54px;
}
[data-theme="dark"] .objection-input-box {
  background: rgba(15, 23, 42, 0.98);
  color: var(--text-dark);
}
[data-theme="light"] .objection-input-box {
  background: rgba(249, 250, 251, 0.98);
  color: var(--text-light);
}

.objection-send-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  margin-top: 2px;
}
.objection-hint {
  font-size: 10px;
  opacity: 0.8;
}

#objectionSendButton {
  border-radius: 999px;
  border: none;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  padding: 6px 12px;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}
[data-theme="dark"] #objectionSendButton {
  background: linear-gradient(135deg, #fb923c, #ef4444);
  color: #fff;
  box-shadow: 0 10px 22px rgba(248, 113, 113, 0.7);
}
[data-theme="light"] #objectionSendButton {
  background: linear-gradient(135deg, #f97316, #dc2626);
  color: #fff;
  box-shadow: 0 10px 22px rgba(239, 68, 68, 0.6);
}

/* ===========================
   CALCULATOR MODAL
   =========================== */

.calc-modal-backdrop {
  position: fixed;
  inset: 0;
  z-index: 70;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(15, 23, 42, 0.78);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
}

.calc-modal-card {
  width: 760px;
  max-width: 96vw;
  max-height: 88vh;
  border-radius: 20px;
  padding: 14px 14px 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
[data-theme="dark"] .calc-modal-card {
  background: radial-gradient(circle at top, #0b1120 0, #020617 60%);
  border: 1px solid rgba(148, 163, 184, 0.9);
  box-shadow: 0 22px 55px rgba(0, 0, 0, 0.9);
  color: var(--text-dark);
}
[data-theme="light"] .calc-modal-card {
  background: #f9fafb;
  border: 1px solid rgba(148, 163, 184, 0.9);
  box-shadow: 0 22px 55px rgba(15, 23, 42, 0.35);
  color: var(--text-light);
}

.calc-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}
.calc-modal-title-group {
  display: flex;
  flex-direction: column;
  gap: 2px;
}
.calc-modal-tag {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  opacity: 0.8;
}
.calc-modal-title {
  font-size: 14px;
  font-weight: 600;
}
.calc-modal-sub {
  font-size: 11px;
  opacity: 0.8;
}

.calc-modal-close {
  border-radius: 999px;
  border: 1px solid rgba(148, 163, 184, 0.9);
  background: transparent;
  width: 28px;
  height: 28px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 14px;
}

/* Tabs */
.calc-tabs {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  margin-top: 6px;
}

.calc-tab {
  border-radius: 999px;
  padding: 5px 12px;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  cursor: pointer;
  border: 1px solid;
  background: transparent;
}
[data-theme="dark"] .calc-tab {
  border-color: rgba(148, 163, 184, 0.85);
  color: var(--text-muted-dark);
}
[data-theme="light"] .calc-tab {
  border-color: rgba(148, 163, 184, 0.9);
  color: var(--text-muted-light);
}
.calc-tab.is-active {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent);
}

/* Calc body (2-column) */
.calc-body {
  display: grid;
  grid-template-columns: minmax(0, 0.9fr) minmax(0, 1fr);
  gap: 14px;
  margin-top: 10px;
}
@media (max-width: 800px) {
  .calc-body {
    grid-template-columns: minmax(0, 1fr);
  }
}

.calc-section {
  border-radius: 14px;
  padding: 10px 11px;
}
[data-theme="dark"] .calc-section {
  background: rgba(15, 23, 42, 0.98);
  border: 1px solid rgba(51, 65, 85, 0.9);
}
[data-theme="light"] .calc-section {
  background: rgba(249, 250, 251, 0.98);
  border: 1px solid rgba(148, 163, 184, 0.9);
}

.calc-row {
  display: flex;
  flex-direction: column;
  gap: 3px;
  margin-bottom: 8px;
}
.calc-row label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  opacity: 0.8;
}
.calc-row input {
  width: 100%;
  border-radius: 10px;
  border: 1px solid;
  padding: 6px 8px;
  font-size: 13px;
}
[data-theme="dark"] .calc-row input {
  background: rgba(15, 23, 42, 0.96);
  border-color: rgba(55, 65, 81, 0.95);
  color: var(--text-dark);
}
[data-theme="light"] .calc-row input {
  background: rgba(249, 250, 251, 0.96);
  border-color: rgba(148, 163, 184, 0.9);
  color: var(--text-light);
}

.primary-btn {
  width: 100%;
  margin-top: 4px;
}

/* Calc results */
.calc-results {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.calc-result-card {
  border-radius: 12px;
  padding: 8px 10px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
[data-theme="dark"] .calc-result-card {
  background: rgba(15, 23, 42, 0.96);
  border: 1px solid rgba(55, 65, 81, 0.95);
}
[data-theme="light"] .calc-result-card {
  background: rgba(249, 250, 251, 0.96);
  border: 1px solid rgba(148, 163, 184, 0.9);
}

.calc-result-label {
  font-size: 11px;
  opacity: 0.8;
}
.calc-result-value {
  font-size: 14px;
  font-weight: 600;
}

/* Responsive layout adjustments */
@media (max-width: 900px) {
  body {
    padding: 10px;
  }
  .app-shell {
    padding: 14px 12px;
  }
  .layout {
    grid-template-columns: minmax(0, 1fr);
  }
  .step1,
  .step2,
  .side-launcher-wrapper {
    grid-column: 1 / 2;
  }
}
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>Lot Rocket ¬∑ Social Media Kit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg-dark: #05060a;
      --bg-dark-alt: #0c0f17;
      --bg-light: #f5f5f7;
      --bg-light-alt: #ffffff;
      --accent: #ff4b4b;
      --accent-soft: rgba(255, 75, 75, 0.15);
      --border-dark: #252836;
      --border-light: #d0d3dd;
      --text-dark: #f9fafb;
      --text-muted-dark: #9ca3af;
      --text-light: #111827;
      --text-muted-light: #6b7280;
      --card-radius: 18px;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.4);
      --shadow-soft-light: 0 18px 40px rgba(15, 23, 42, 0.18);
      --input-radius: 12px;
      --transition-fast: 0.18s ease-out;
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        sans-serif;
    }

    [data-theme="dark"] body {
      background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
      color: var(--text-dark);
    }
    [data-theme="light"] body {
      background: radial-gradient(circle at top, #e5e7eb 0, #f9fafb 40%, #e5e7eb 100%);
      color: var(--text-light);
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font-main);
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 24px;
      box-sizing: border-box;
    }

    .app-shell {
      width: 100%;
      max-width: 1240px;
      border-radius: 26px;
      padding: 20px 22px 26px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 14px;
      position: relative;
      overflow: hidden;
    }

    [data-theme="dark"] .app-shell {
      background: radial-gradient(circle at top left, #1f2937 0, #020617 60%);
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }
    [data-theme="light"] .app-shell {
      background: linear-gradient(135deg, #f9fafb, #e5e7eb);
      box-shadow: var(--shadow-soft-light);
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .title-group {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-circle {
      width: 70px;
      height: 70px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-sizing: border-box;
    }
    [data-theme="dark"] .logo-circle {
      border: 2px solid #ef4444;
      color: #ef4444;
      background: radial-gradient(
        circle at center,
        rgba(239, 68, 68, 0.08),
        transparent 60%
      );
    }
    [data-theme="light"] .logo-circle {
      border: 2px solid #b91c1c;
      color: #b91c1c;
      background: #fff;
    }
    .logo-inner {
      font-weight: 800;
      font-size: 30px;
      line-height: 1;
      position: relative;
      font-family: "Times New Roman", Georgia, serif;
    }
    .logo-inner span.rocket {
      position: absolute;
      left: 52%;
      top: 32%;
      font-size: 16px;
      transform: translateX(-50%);
    }
    .logo-text-main {
      font-weight: 700;
      font-size: 18px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }
    .logo-text-sub {
      font-size: 13px;
      opacity: 0.78;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
    }

    .chip {
      padding: 5px 10px;
      border-radius: 999px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    [data-theme="dark"] .chip {
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-muted-dark);
    }
    [data-theme="light"] .chip {
      background: rgba(255, 255, 255, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-muted-light);
    }
    .chip span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15);
    }

    .theme-toggle {
      border-radius: 999px;
      padding: 6px 10px;
      border: none;
      cursor: pointer;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background var(--transition-fast), transform var(--transition-fast),
        box-shadow var(--transition-fast), color var(--transition-fast);
    }
    [data-theme="dark"] .theme-toggle {
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-muted-dark);
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.45);
    }
    [data-theme="light"] .theme-toggle {
      background: rgba(255, 255, 255, 0.95);
      color: var(--text-muted-light);
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.5);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 0.95fr) minmax(0, 1.3fr);
      gap: 16px;
      margin-top: 6px;
    }
    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      border-radius: var(--card-radius);
      padding: 14px 14px 13px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
    }
    [data-theme="dark"] .card {
      background: radial-gradient(circle at top left, #111827 0, #020617 60%);
      border: 1px solid rgba(51, 65, 85, 0.9);
    }
    [data-theme="light"] .card {
      background: rgba(255, 255, 255, 0.92);
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .card-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
    }
    .card-title {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    .card-subtitle {
      font-size: 12px;
      opacity: 0.75;
    }

    .badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    [data-theme="dark"] .badge {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(107, 114, 128, 0.9);
      color: var(--text-muted-dark);
    }
    [data-theme="light"] .badge {
      background: rgba(249, 250, 251, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.9);
      color: var(--text-muted-light);
    }

    label.field-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.8;
      margin-bottom: 4px;
      display: block;
    }

    .field-group {
      margin-bottom: 8px;
    }

    .input,
    .textarea {
      width: 100%;
      box-sizing: border-box;
      border-radius: var(--input-radius);
      border: 1px solid;
      padding: 7px 9px;
      font-family: var(--font-main);
      font-size: 13px;
      resize: vertical;
      min-height: 34px;
      outline: none;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast),
        background var(--transition-fast), color var(--transition-fast);
    }
    .textarea {
      white-space: pre-wrap;
    }

    [data-theme="dark"] .input,
    [data-theme="dark"] .textarea {
      background: rgba(15, 23, 42, 0.95);
      border-color: rgba(55, 65, 81, 0.95);
      color: var(--text-dark);
    }
    [data-theme="light"] .input,
    [data-theme="light"] .textarea {
      background: rgba(249, 250, 251, 0.96);
      border-color: rgba(148, 163, 184, 0.9);
      color: var(--text-light);
    }

    .input:focus,
    .textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.5);
    }

    .button-primary {
      border-radius: 999px;
      padding: 7px 16px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast),
        background var(--transition-fast);
    }
    [data-theme="dark"] .button-primary {
      background: linear-gradient(135deg, #fb923c, #ef4444);
      color: #fff;
      box-shadow: 0 14px 30px rgba(248, 113, 113, 0.7);
    }
    [data-theme="light"] .button-primary {
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: #fff;
      box-shadow: 0 12px 26px rgba(239, 68, 68, 0.6);
    }
    .button-primary:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: none;
    }

    .button-ghost {
      border-radius: 999px;
      padding: 5px 10px;
      border: 1px solid;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: transparent;
      transition: background var(--transition-fast), border-color var(--transition-fast),
        color var(--transition-fast);
    }
    [data-theme="dark"] .button-ghost {
      border-color: rgba(75, 85, 99, 0.85);
      color: var(--text-muted-dark);
    }
    [data-theme="light"] .button-ghost {
      border-color: rgba(148, 163, 184, 0.9);
      color: var(--text-muted-light);
    }
    .button-ghost span.icon {
      font-size: 13px;
    }

    .stack-vertical {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .pill-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: flex-start;
    }

    .pill {
      border-radius: 999px;
      padding: 5px 9px;
      font-size: 11px;
      border: 1px solid;
    }
    [data-theme="dark"] .pill {
      background: rgba(15, 23, 42, 0.9);
      border-color: rgba(55, 65, 81, 0.9);
      color: var(--text-muted-dark);
    }
    [data-theme="light"] .pill {
      background: rgba(249, 250, 251, 0.96);
      border-color: rgba(148, 163, 184, 0.9);
      color: var(--text-muted-light);
    }

    .photos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 6px;
    }
    .photo-thumb {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      aspect-ratio: 4 / 3;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }
    .photo-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .status-text {
      font-size: 11px;
      opacity: 0.8;
    }

    .section-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .social-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }
    @media (max-width: 900px) {
      .social-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .social-card {
      border-radius: 16px;
      padding: 10px 11px 9px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      border: 1px solid rgba(148, 163, 184, 0.75);
      min-height: 200px;
    }
    [data-theme="dark"] .social-card {
      background: rgba(15, 23, 42, 0.98);
    }
    [data-theme="light"] .social-card {
      background: rgba(249, 250, 251, 0.98);
    }

    .social-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    .social-platform {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .textarea.post-box {
      min-height: 210px;
      max-height: 260px;
      font-size: 13px;
      line-height: 1.35;
    }

    .textarea.marketplace-box {
      min-height: 230px;
      max-height: 280px;
    }

    .textarea.script {
      min-height: 160px;
    }

    .textarea.shotplan {
      min-height: 130px;
    }

    .textarea.design {
      min-height: 180px;
    }

    .tiny-note {
      font-size: 10px;
      opacity: 0.75;
      margin-top: 4px;
    }

    .loading-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      display: inline-block;
      margin-right: 4px;
      animation: pulse 1s infinite alternate;
    }
    @keyframes pulse {
      from {
        transform: scale(1);
        opacity: 0.8;
      }
      to {
        transform: scale(1.4);
        opacity: 0.3;
      }
    }

    .hidden {
      display: none !important;
    }

    /* Objection modal (unchanged) */

    .objection-modal-backdrop {
      position: fixed;
      inset: 0;
      z-index: 70;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.78);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    .objection-modal-card {
      width: 620px;
      max-width: 96vw;
      max-height: 82vh;
      border-radius: 20px;
      padding: 14px 14px 12px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    [data-theme="dark"] .objection-modal-card {
      background: radial-gradient(circle at top, #111827 0, #020617 60%);
      border: 1px solid rgba(248, 113, 113, 0.8);
      box-shadow: 0 22px 55px rgba(0, 0, 0, 0.9);
      color: var(--text-dark);
    }
    [data-theme="light"] .objection-modal-card {
      background: #f9fafb;
      border: 1px solid rgba(248, 113, 113, 0.9);
      box-shadow: 0 22px 55px rgba(15, 23, 42, 0.35);
      color: var(--text-light);
    }

    .objection-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    .objection-modal-title-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .objection-modal-tag {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      opacity: 0.8;
    }
    .objection-modal-title {
      font-size: 14px;
      font-weight: 600;
    }
    .objection-modal-sub {
      font-size: 11px;
      opacity: 0.8;
    }

    .objection-modal-close {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: transparent;
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
    }

    .objection-chat-area {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
      flex: 1 1 auto;
      min-height: 0;
    }

    .objection-history {
      flex: 1 1 auto;
      min-height: 160px;
      max-height: 330px;
      border-radius: 12px;
      padding: 8px 9px;
      box-sizing: border-box;
      overflow-y: auto;
      font-size: 12px;
      line-height: 1.4;
      border: 1px solid rgba(148, 163, 184, 0.8);
    }
    [data-theme="dark"] .objection-history {
      background: rgba(15, 23, 42, 0.96);
    }
    [data-theme="light"] .objection-history {
      background: rgba(249, 250, 251, 0.98);
    }

    .objection-bubble {
      margin-bottom: 6px;
      padding: 6px 8px;
      border-radius: 10px;
      white-space: pre-wrap;
    }
    .objection-bubble.you-label,
    .objection-bubble.coach-label {
      font-weight: 600;
      font-size: 11px;
      opacity: 0.8;
      margin-bottom: 2px;
      padding: 0;
    }

    [data-theme="dark"] .objection-bubble.you {
      background: rgba(37, 99, 235, 0.32);
      border: 1px solid rgba(59, 130, 246, 0.7);
    }
    [data-theme="light"] .objection-bubble.you {
      background: rgba(191, 219, 254, 0.7);
      border: 1px solid rgba(59, 130, 246, 0.8);
    }
    [data-theme="dark"] .objection-bubble.coach {
      background: rgba(248, 113, 113, 0.22);
      border: 1px solid rgba(248, 113, 113, 0.8);
    }
    [data-theme="light"] .objection-bubble.coach {
      background: rgba(254, 226, 226, 0.92);
      border: 1px solid rgba(248, 113, 113, 0.9);
    }

    .objection-input-row {
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-top: 4px;
    }

    .objection-input-box {
      width: 100%;
      box-sizing: border-box;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      font-family: var(--font-main);
      font-size: 12px;
      padding: 7px 8px;
      resize: vertical;
      min-height: 54px;
    }
    [data-theme="dark"] .objection-input-box {
      background: rgba(15, 23, 42, 0.98);
      color: var(--text-dark);
    }
    [data-theme="light"] .objection-input-box {
      background: rgba(249, 250, 251, 0.98);
      color: var(--text-light);
    }

    .objection-send-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 2px;
    }
    .objection-hint {
      font-size: 10px;
      opacity: 0.8;
    }

    #objectionSendButton {
      border-radius: 999px;
      border: none;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 6px 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    [data-theme="dark"] #objectionSendButton {
      background: linear-gradient(135deg, #fb923c, #ef4444);
      color: #fff;
      box-shadow: 0 10px 22px rgba(248, 113, 113, 0.7);
    }
    [data-theme="light"] #objectionSendButton {
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: #fff;
      box-shadow: 0 10px 22px rgba(239, 68, 68, 0.6);
    }

    @media (max-width: 640px) {
      .objection-modal-card {
        width: 100%;
        margin: 0 10px;
        max-height: 86vh;
      }
    }

    /* ===========================
       SIDE LAUNCHER BUTTONS
       =========================== */

    .side-launcher-wrapper {
      position: absolute;
      top: 220px;   /* adjust up/down if needed */
      right: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 60;
    }

    .side-launcher-btn {
      min-width: 180px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7eb;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      justify-content: flex-start;
      gap: 8px;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }

    .side-launcher-btn .icon {
      font-size: 14px;
    }

    .side-launcher-btn:hover {
      border-color: rgba(248, 113, 113, 0.9);
    }

    [data-theme="light"] .side-launcher-btn {
      background: rgba(255, 255, 255, 0.96);
      color: #111827;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.25);
    }

    @media (max-width: 1024px) {
      .side-launcher-wrapper {
        position: static;
        margin-top: 10px;
        flex-direction: row;
        justify-content: flex-end;
      }
    }

    /* ===========================
       CALCULATOR MODAL
       =========================== */

    .calc-modal-backdrop {
      position: fixed;
      inset: 0;
      z-index: 70;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.78);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    .calc-modal-card {
      width: 800px;
      max-width: 96vw;
      max-height: 86vh;
      border-radius: 20px;
      padding: 14px 14px 12px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    [data-theme="dark"] .calc-modal-card {
      background: radial-gradient(circle at top, #020617 0, #020617 60%);
      border: 1px solid rgba(148, 163, 184, 0.9);
      box-shadow: 0 22px 55px rgba(0, 0, 0, 0.9);
      color: var(--text-dark);
    }
    [data-theme="light"] .calc-modal-card {
      background: #f9fafb;
      border: 1px solid rgba(148, 163, 184, 0.9);
      box-shadow: 0 22px 55px rgba(15, 23, 42, 0.35);
      color: var(--text-light);
    }

    .calc-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .calc-modal-title-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .calc-modal-title {
      font-size: 14px;
      font-weight: 600;
    }

    .calc-modal-sub {
      font-size: 11px;
      opacity: 0.8;
    }

    .calc-modal-close {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: transparent;
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
    }

    .calc-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 6px;
    }
    @media (max-width: 900px) {
      .calc-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .calc-card {
      border-radius: 14px;
      padding: 10px 11px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 6px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      font-size: 12px;
    }
    [data-theme="dark"] .calc-card {
      background: rgba(15, 23, 42, 0.96);
    }
    [data-theme="light"] .calc-card {
      background: rgba(249, 250, 251, 0.98);
    }

    .calc-card h3 {
      margin: 0;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .calc-field-row {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-bottom: 4px;
    }

    .calc-field-row label {
      font-size: 11px;
    }

    .calc-result {
      margin-top: 4px;
      font-size: 12px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="title-group">
        <div class="logo-circle">
          <div class="logo-inner">
            LR
            <span class="rocket">üöÄ</span>
          </div>
        </div>
        <div>
          <div class="logo-text-main">Lot Rocket</div>
          <div class="logo-text-sub">
            Social Media Kit ¬∑ Prototype for salespeople, not stores
          </div>
        </div>
      </div>
      <div class="header-right">
        <div class="chip">
          <span class="dot"></span>
          <span>AI-ASSISTED COPY ¬∑ BETA</span>
        </div>
        <button id="themeToggle" class="theme-toggle" type="button">
          <span id="themeIcon">üåô</span>
          <span id="themeLabel">Dark</span>
        </button>
      </div>
    </header>

    <div class="layout">
      <!-- LEFT: STEP 1 -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Step 1 ¬∑ Dealer URL</div>
            <div class="card-subtitle">
              Paste a full vehicle detail page. We‚Äôll pull photos and build the kit.
            </div>
          </div>
          <span class="badge">INPUT</span>
        </div>

        <div class="stack-vertical">
          <div class="field-group">
            <label class="field-label" for="vehicleUrl">Dealer vehicle URL</label>
            <input
              id="vehicleUrl"
              class="input"
              placeholder="https://dealer.com/used-YourVehicleHere..."
            />
          </div>

          <div class="pill-row">
            <button id="boostButton" class="button-primary" type="button">
              <span>üöÄ Boost This Listing</span>
            </button>
            <span id="statusText" class="status-text"
              >Paste URL, then tap Boost.</span
            >
          </div>

          <div class="field-group">
            <label class="field-label" for="vehicleLabel">Vehicle label (editable)</label>
            <input
              id="vehicleLabel"
              class="input"
              placeholder="2024 Chevrolet Blazer 2LT ‚Äì Plymouth, MI ‚Äì Used"
            />
          </div>

          <div class="field-group">
            <label class="field-label" for="priceInfo">Price / deal info (editable)</label>
            <input
              id="priceInfo"
              class="input"
              placeholder="Message for current pricing"
            />
          </div>
        </div>

        <div class="stack-vertical">
          <div class="section-title-row">
            <div>
              <div class="card-title">Media Tools</div>
              <div class="card-subtitle">
                We‚Äôll auto-pull photos on Boost and turn them into a simple video
                plan.
              </div>
            </div>
            <button id="buildVideoButton" class="button-ghost" type="button">
              <span class="icon">üé¨</span><span>Build Video from Photos</span>
            </button>
          </div>

          <div class="field-group">
            <label class="field-label">Dealer Photos</label>
            <div id="photosGrid" class="photos-grid"></div>
            <div id="photosStatus" class="tiny-note">
              Photos will auto-load after Boost if we can find them.
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="videoPlan">Video From Photos Plan</label>
            <textarea
              id="videoPlan"
              class="textarea shotplan"
              placeholder="Hit 'Build Video from Photos' after photos load to get a simple shot list for Reels / TikTok."
              readonly
            ></textarea>
          </div>
        </div>
      </section>

      <!-- RIGHT: STEP 2 -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Step 2 ¬∑ Social Kit</div>
            <div class="card-subtitle">
              Copy, tweak, and paste into each platform. Spin fresh versions anytime.
            </div>
          </div>
          <span class="badge">OUTPUT</span>
        </div>

        <div class="stack-vertical">
          <div class="field-group">
            <label class="field-label">Listing Summary</label>
            <div class="pill-row">
              <span id="summaryLabel" class="pill">No vehicle yet</span>
              <span id="summaryPrice" class="pill">‚Äî</span>
            </div>
          </div>

          <div class="field-group">
            <label class="field-label">Social Media Posts</label>
            <div class="card-subtitle">
              Each box is copy-and-paste ready. Hit ‚ÄúNew Post‚Äù to spin a fresh
              version for that platform.
            </div>
          </div>

          <div class="social-grid">
            <!-- Facebook -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üìò Facebook</div>
                <button
                  data-platform="facebook"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Post</span>
                </button>
              </div>
              <textarea id="facebookPost" class="textarea post-box" readonly></textarea>
            </div>

            <!-- Instagram -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üì∏ Instagram</div>
                <button
                  data-platform="instagram"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Post</span>
                </button>
              </div>
              <textarea
                id="instagramPost"
                class="textarea post-box"
                readonly
              ></textarea>
            </div>

            <!-- TikTok -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üéµ TikTok</div>
                <button
                  data-platform="tiktok"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Post</span>
                </button>
              </div>
              <textarea id="tiktokPost" class="textarea post-box" readonly></textarea>
            </div>

            <!-- LinkedIn -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üíº LinkedIn</div>
                <button
                  data-platform="linkedin"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Post</span>
                </button>
              </div>
              <textarea
                id="linkedinPost"
                class="textarea post-box"
                readonly
              ></textarea>
            </div>

            <!-- Twitter -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üê¶ X / Twitter</div>
                <button
                  data-platform="twitter"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Post</span>
                </button>
              </div>
              <textarea id="twitterPost" class="textarea post-box" readonly></textarea>
            </div>

            <!-- Text / DM -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üí¨ Text / DM</div>
                <button
                  data-platform="text"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Text</span>
                </button>
              </div>
              <textarea id="textBlurb" class="textarea post-box" readonly></textarea>
            </div>

            <!-- Marketplace -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üõí Marketplace</div>
                <button
                  data-platform="marketplace"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Post</span>
                </button>
              </div>
              <textarea
                id="marketplacePost"
                class="textarea marketplace-box"
                readonly
              ></textarea>
            </div>

            <!-- Hashtags -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üè∑ Hashtags</div>
                <button
                  data-platform="hashtags"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Tags</span>
                </button>
              </div>
              <textarea id="hashtags" class="textarea post-box" readonly></textarea>
            </div>
          </div>

          <div class="field-group">
            <div class="section-title-row">
              <label class="field-label">Video Engine</label>
              <button id="newScriptButton" class="button-ghost" type="button">
                <span class="icon">üîÅ</span><span>New Script</span>
              </button>
            </div>
            <div class="card-subtitle">
              Script + shot plan you can read on camera and follow for Reels, TikTok,
              Shorts, or Facebook Reels.
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="videoScript">Viral Video Script</label>
            <textarea
              id="videoScript"
              class="textarea script"
              readonly
            ></textarea>
          </div>

          <div class="field-group">
            <label class="field-label" for="shotPlan">Viral Visual Shot Plan</label>
            <textarea
              id="shotPlan"
              class="textarea shotplan"
              readonly
            ></textarea>
          </div>

          <div class="field-group">
            <div class="section-title-row">
              <label class="field-label">Design Lab (Canva-style layout)</label>
              <div class="card-subtitle">
                Get a ready-to-build graphic layout you can recreate in Canva.
              </div>
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="designType">Design Type</label>
            <div class="pill-row">
              <select
                id="designType"
                class="input"
                style="max-width: 260px; padding-right: 28px"
              >
                <option value="facebook_feed_post">Facebook feed post</option>
                <option value="instagram_feed_post">
                  Instagram feed post
                </option>
                <option value="instagram_story">Instagram Story</option>
                <option value="reels_cover">Reels / TikTok cover image</option>
                <option value="tiktok_vertical_graphic">
                  TikTok vertical graphic
                </option>
                <option value="youtube_thumbnail">YouTube thumbnail</option>
              </select>
              <button id="designButton" class="button-ghost" type="button">
                <span class="icon">üé®</span><span>Generate Design Idea</span>
              </button>
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="designOutput">Design Layout Plan</label>
            <textarea
              id="designOutput"
              class="textarea design"
              placeholder="Choose a design type and hit Generate to get a Canva-style layout you can build in minutes."
              readonly
            ></textarea>
          </div>

          <div class="tiny-note">
            Prototype for salespeople. Copy, tweak, and make it yours. üöÄ
          </div>
        </div>
      </section>
    </div>

    <!-- SIDE LAUNCHER BUTTONS -->
    <div class="side-launcher-wrapper">
      <button id="objectionLauncher" class="side-launcher-btn" type="button">
        <span class="icon">üß†</span>
        <span>Objection coach</span>
      </button>
      <button id="calcLauncher" class="side-launcher-btn" type="button">
        <span class="icon">üìä</span>
        <span>Calculators</span>
      </button>
    </div>
  </div>

  <!-- OBJECTION COACH MODAL -->
  <div id="objectionModal" class="objection-modal-backdrop hidden">
    <div class="objection-modal-card">
      <div class="objection-modal-header">
        <div class="objection-modal-title-group">
          <div class="objection-modal-tag">OBJECTIONS HANDLED</div>
          <div class="objection-modal-title">Andy Elliott‚Äìstyle AI coach</div>
          <div class="objection-modal-sub">
            Paste a customer objection or ask how to respond. Get word tracks and
            breakdowns.
          </div>
        </div>
        <button
          id="objectionCloseButton"
          class="objection-modal-close"
          type="button"
        >
          ‚úï
        </button>
      </div>

      <div class="objection-chat-area">
        <div id="objectionHistory" class="objection-history"></div>

        <div class="objection-input-row">
          <textarea
            id="objectionInput"
            class="objection-input-box"
            placeholder='Example: "I need to think about it" or "Payment is too high" or ask: "How do I close a be-back?"'
          ></textarea>

          <div class="objection-send-row">
            <div class="objection-hint">
              Tip: Enter to make a new line. Ctrl+Enter / Cmd+Enter to send fast.
            </div>
            <button id="objectionSendButton" type="button">
              <span>üß† Handle this objection</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CALCULATOR MODAL -->
  <div id="calcModal" class="calc-modal-backdrop hidden">
    <div class="calc-modal-card">
      <div class="calc-modal-header">
        <div class="calc-modal-title-group">
          <div class="calc-modal-title">Deal Desk Calculators</div>
          <div class="calc-modal-sub">
            Quick numbers you can share with a customer on the spot.
          </div>
        </div>
        <button id="calcCloseButton" class="calc-modal-close" type="button">
          ‚úï
        </button>
      </div>

      <div class="calc-grid">
        <!-- Payment Calculator -->
        <div class="calc-card">
          <h3>Payment</h3>
          <form id="paymentForm">
            <div class="calc-field-row">
              <label for="payPrice">Vehicle price</label>
              <input
                id="payPrice"
                class="input"
                type="number"
                min="0"
                step="100"
                placeholder="35000"
              />
            </div>
            <div class="calc-field-row">
              <label for="payDown">Down payment</label>
              <input
                id="payDown"
                class="input"
                type="number"
                min="0"
                step="100"
                placeholder="2000"
              />
            </div>
            <div class="calc-field-row">
              <label for="payTerm">Term (months)</label>
              <input
                id="payTerm"
                class="input"
                type="number"
                min="12"
                step="12"
                placeholder="72"
              />
            </div>
            <div class="calc-field-row">
              <label for="payApr">APR %</label>
              <input
                id="payApr"
                class="input"
                type="number"
                min="0"
                step="0.1"
                placeholder="7.5"
              />
            </div>
            <button class="button-ghost" type="submit">
              <span class="icon">üßÆ</span><span>Calculate</span>
            </button>
          </form>
          <div class="calc-result" id="payResult">$0.00 / mo</div>
        </div>

        <!-- Affordability -->
        <div class="calc-card">
          <h3>Affordability</h3>
          <form id="affordForm">
            <div class="calc-field-row">
              <label for="affBudget">Max monthly budget</label>
              <input
                id="affBudget"
                class="input"
                type="number"
                min="0"
                step="50"
                placeholder="450"
              />
            </div>
            <div class="calc-field-row">
              <label for="affTerm">Term (months)</label>
              <input
                id="affTerm"
                class="input"
                type="number"
                min="12"
                step="12"
                placeholder="72"
              />
            </div>
            <div class="calc-field-row">
              <label for="affApr">APR %</label>
              <input
                id="affApr"
                class="input"
                type="number"
                min="0"
                step="0.1"
                placeholder="7.5"
              />
            </div>
            <button class="button-ghost" type="submit">
              <span class="icon">üìà</span><span>Estimate</span>
            </button>
          </form>
          <div class="calc-result" id="affResult">Max price: $0</div>
        </div>

        <!-- Income Builder -->
        <div class="calc-card">
          <h3>Income Builder</h3>
          <form id="incomeForm">
            <div class="calc-field-row">
              <label for="incGoal">Monthly income goal ($)</label>
              <input
                id="incGoal"
                class="input"
                type="number"
                min="0"
                step="500"
                placeholder="10000"
              />
            </div>
            <div class="calc-field-row">
              <label for="incPerDeal">Average per deal ($)</label>
              <input
                id="incPerDeal"
                class="input"
                type="number"
                min="0"
                step="50"
                placeholder="500"
              />
            </div>
            <div class="calc-field-row">
              <label for="incDays">Work days per month</label>
              <input
                id="incDays"
                class="input"
                type="number"
                min="10"
                max="31"
                step="1"
                placeholder="24"
              />
            </div>
            <div class="calc-field-row">
              <label for="incClose">Close rate %</label>
              <input
                id="incClose"
                class="input"
                type="number"
                min="1"
                max="100"
                step="1"
                placeholder="20"
              />
            </div>
            <button class="button-ghost" type="submit">
              <span class="icon">üìä</span><span>Build plan</span>
            </button>
          </form>
          <div class="calc-result" id="incResult">
            Deals/mo: 0 ¬∑ Deals/day: 0 ¬∑ Shows/day: 0 ¬∑ Appts/day: 0
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const apiBase = "";

    const vehicleUrlInput = document.getElementById("vehicleUrl");
    const vehicleLabelInput = document.getElementById("vehicleLabel");
    const priceInfoInput = document.getElementById("priceInfo");
    const boostButton = document.getElementById("boostButton");
    const statusText = document.getElementById("statusText");

    const summaryLabel = document.getElementById("summaryLabel");
    const summaryPrice = document.getElementById("summaryPrice");

    const facebookPost = document.getElementById("facebookPost");
    const instagramPost = document.getElementById("instagramPost");
    const tiktokPost = document.getElementById("tiktokPost");
    const linkedinPost = document.getElementById("linkedinPost");
    const twitterPost = document.getElementById("twitterPost");
    const textBlurb = document.getElementById("textBlurb");
    const marketplacePost = document.getElementById("marketplacePost");
    const hashtags = document.getElementById("hashtags");
    const videoScript = document.getElementById("videoScript");
    const shotPlan = document.getElementById("shotPlan");

    const buildVideoButton = document.getElementById("buildVideoButton");
    const photosGrid = document.getElementById("photosGrid");
    const photosStatus = document.getElementById("photosStatus");
    const videoPlan = document.getElementById("videoPlan");

    const newScriptButton = document.getElementById("newScriptButton");

    const designTypeSelect = document.getElementById("designType");
    const designButton = document.getElementById("designButton");
    const designOutput = document.getElementById("designOutput");

    const themeToggle = document.getElementById("themeToggle");
    const themeIcon = document.getElementById("themeIcon");
    const themeLabel = document.getElementById("themeLabel");

    const objectionLauncher = document.getElementById("objectionLauncher");
    const objectionModal = document.getElementById("objectionModal");
    const objectionCloseButton = document.getElementById("objectionCloseButton");
    const objectionHistory = document.getElementById("objectionHistory");
    const objectionInput = document.getElementById("objectionInput");
    const objectionSendButton = document.getElementById("objectionSendButton");

    const calcLauncher = document.getElementById("calcLauncher");
    const calcModal = document.getElementById("calcModal");
    const calcCloseButton = document.getElementById("calcCloseButton");

    let currentPhotos = [];
    let currentUrl = "";
    let isBoosting = false;

    let objectionMessages = [];

    function applyTheme(theme) {
      const root = document.documentElement;
      root.setAttribute("data-theme", theme);
      if (theme === "dark") {
        themeIcon.textContent = "üåô";
        themeLabel.textContent = "Dark";
      } else {
        themeIcon.textContent = "‚òÄÔ∏è";
        themeLabel.textContent = "Light";
      }
      localStorage.setItem("lotRocketTheme", theme);
    }

    function initTheme() {
      const saved = localStorage.getItem("lotRocketTheme");
      if (saved === "light" || saved === "dark") {
        applyTheme(saved);
      } else {
        applyTheme("dark");
      }
    }

    themeToggle.addEventListener("click", () => {
      const current =
        document.documentElement.getAttribute("data-theme") || "dark";
      const next = current === "dark" ? "light" : "dark";
      applyTheme(next);
    });

    initTheme();

    function setStatus(text, isLoading = false) {
      if (isLoading) {
        statusText.innerHTML =
          '<span class="loading-dot"></span>' + text;
      } else {
        statusText.textContent = text;
      }
    }

    function safeTrim(str) {
      return (str || "").toString().trim();
    }

    function updateSummary(label, price) {
      summaryLabel.textContent = safeTrim(label) || "Vehicle ready";
      summaryPrice.textContent =
        safeTrim(price) || "Message for current pricing";
    }

    function fillSocialKit(kit) {
      facebookPost.value = kit.facebook || "";
      instagramPost.value = kit.instagram || "";
      tiktokPost.value = kit.tiktok || "";
      linkedinPost.value = kit.linkedin || "";
      twitterPost.value = kit.twitter || "";
      textBlurb.value = kit.textBlurb || "";
      marketplacePost.value = kit.marketplace || "";
      hashtags.value = kit.hashtags || "";
      videoScript.value = kit.videoScript || "";
      shotPlan.value = kit.shotPlan || "";
    }

    function renderPhotosGrid(photos) {
      photosGrid.innerHTML = "";
      if (!photos || !photos.length) {
        photosStatus.textContent = "No photos found yet.";
        return;
      }
      photos.forEach((url) => {
        const wrapper = document.createElement("div");
        wrapper.className = "photo-thumb";
        const img = document.createElement("img");
        img.src = url;
        img.alt = "Vehicle photo";
        wrapper.appendChild(img);
        wrapper.addEventListener("click", () => {
          window.open(url, "_blank");
        });
        photosGrid.appendChild(wrapper);
      });
      photosStatus.textContent =
        photos.length + " photos found. Click any to open full size.";
    }

    async function callJson(endpoint, body) {
      const res = await fetch(apiBase + endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body || {}),
      });
      if (!res.ok) {
        const txt = await res.text().catch(() => "");
        throw new Error("Request failed: " + res.status + " " + txt);
      }
      return res.json();
    }

    function renderObjectionChat() {
      objectionHistory.innerHTML = "";
      if (!objectionMessages.length) {
        const empty = document.createElement("div");
        empty.className = "objection-bubble";
        empty.style.opacity = "0.7";
        empty.textContent =
          "Paste the customer objection (or ask a question) and your Andy Elliott‚Äìstyle coach will give you word tracks and breakdowns.";
        objectionHistory.appendChild(empty);
        return;
      }

      objectionMessages.forEach((m) => {
        const labelDiv = document.createElement("div");
        labelDiv.className =
          "objection-bubble " +
          (m.role === "assistant" ? "coach-label" : "you-label");
        labelDiv.textContent =
          m.role === "assistant" ? "COACH" : "YOU";

        const bubble = document.createElement("div");
        bubble.className =
          "objection-bubble " +
          (m.role === "assistant" ? "coach" : "you");
        bubble.textContent = m.content || "";

        objectionHistory.appendChild(labelDiv);
        objectionHistory.appendChild(bubble);
      });

      objectionHistory.scrollTop = objectionHistory.scrollHeight;
    }

    async function handleBoost() {
      if (isBoosting) return;
      const url = safeTrim(vehicleUrlInput.value);
      if (!url) {
        alert("Paste a dealer vehicle URL first.");
        return;
      }

      let label = safeTrim(vehicleLabelInput.value);
      if (!label) {
        label = "This vehicle";
        vehicleLabelInput.value = label;
      }
      let price = safeTrim(priceInfoInput.value);
      if (!price) {
        price = "Message for current pricing";
        priceInfoInput.value = price;
      }

      isBoosting = true;
      boostButton.disabled = true;
      setStatus("Building social kit with AI‚Ä¶", true);

      try {
        currentUrl = url;
        const resp = await callJson("/api/social-kit", { url, label, price });
        if (!resp.success) throw new Error("API returned error");
        fillSocialKit(resp.kit);
        updateSummary(label, price);
        setStatus(
          "Social kit ready. You can spin new posts or scripts anytime."
        );

        objectionMessages = [];
        renderObjectionChat();

        try {
          photosStatus.textContent =
            "Trying to grab photos from dealer page‚Ä¶";
          const photoResp = await callJson("/api/grab-photos", { url });
          if (photoResp.success) {
            currentPhotos = photoResp.photos || [];
            renderPhotosGrid(currentPhotos);
          } else {
            photosStatus.textContent = "Could not grab photos.";
          }
        } catch (err) {
          console.error("Auto photo grab failed:", err);
          photosStatus.textContent = "Auto photo load failed.";
        }
      } catch (err) {
        console.error(err);
        setStatus("Something went wrong. Try again or check the URL.");
        alert("Error building social kit. Check the URL and try again.");
      } finally {
        isBoosting = false;
        boostButton.disabled = false;
      }
    }

    boostButton.addEventListener("click", handleBoost);

    document.querySelectorAll(".button-new-post").forEach((btn) => {
      btn.addEventListener("click", async () => {
        const platform = btn.getAttribute("data-platform");
        const url = safeTrim(vehicleUrlInput.value);
        const label = safeTrim(vehicleLabelInput.value);
        const price = safeTrim(priceInfoInput.value);

        if (!url || !label) {
          alert(
            "Please paste a URL and hit Boost at least once before spinning posts."
          );
          return;
        }

        btn.disabled = true;
        const oldText = btn.innerHTML;
        btn.innerHTML = '<span class="icon">‚è≥</span><span>Working‚Ä¶</span>';

        try {
          const resp = await callJson("/api/new-post", {
            platform,
            url,
            label,
            price,
          });
          if (!resp.success) throw new Error("API returned error");
          const text = resp.post || "";

          switch (platform) {
            case "facebook":
              facebookPost.value = text;
              break;
            case "instagram":
              instagramPost.value = text;
              break;
            case "tiktok":
              tiktokPost.value = text;
              break;
            case "linkedin":
              linkedinPost.value = text;
              break;
            case "twitter":
              twitterPost.value = text;
              break;
            case "text":
              textBlurb.value = text;
              break;
            case "marketplace":
              marketplacePost.value = text;
              break;
            case "hashtags":
              hashtags.value = text;
              break;
          }
        } catch (err) {
          console.error(err);
          alert("Error generating a new post. Try again.");
        } finally {
          btn.disabled = false;
          btn.innerHTML = oldText;
        }
      });
    });

    newScriptButton.addEventListener("click", async () => {
      const url = safeTrim(vehicleUrlInput.value);
      const label = safeTrim(vehicleLabelInput.value);
      const price = safeTrim(priceInfoInput.value);

      if (!url || !label) {
        alert(
          "Please paste a URL and hit Boost at least once before spinning scripts."
        );
        return;
      }

      newScriptButton.disabled = true;
      const oldText = newScriptButton.innerHTML;
      newScriptButton.innerHTML =
        '<span class="icon">‚è≥</span><span>Working‚Ä¶</span>';

      try {
        const resp = await callJson("/api/new-script", {
          url,
          label,
          price,
        });
        if (!resp.success) throw new Error("API error");
        videoScript.value = resp.script || "";
      } catch (err) {
        console.error(err);
        alert("Error generating a new script. Try again.");
      } finally {
        newScriptButton.disabled = false;
        newScriptButton.innerHTML = oldText;
      }
    });

    buildVideoButton.addEventListener("click", async () => {
      if (!currentPhotos || !currentPhotos.length) {
        alert("No photos yet. Boost a listing first so we can grab photos.");
        return;
      }

      buildVideoButton.disabled = true;
      const oldText = buildVideoButton.innerHTML;
      buildVideoButton.innerHTML =
        '<span class="icon">‚è≥</span><span>Building‚Ä¶</span>';

      try {
        const label = safeTrim(vehicleLabelInput.value) || "this vehicle";
        const resp = await callJson("/api/video-from-photos", {
          photos: currentPhotos,
          label,
        });
        if (!resp.success) throw new Error("API error");
        videoPlan.value = resp.plan || "";
      } catch (err) {
        console.error(err);
        alert("Error building video plan. Try again.");
      } finally {
        buildVideoButton.disabled = false;
        buildVideoButton.innerHTML = oldText;
      }
    });

    designButton.addEventListener("click", async () => {
      const type = designTypeSelect.value;
      const url = safeTrim(vehicleUrlInput.value);
      const label = safeTrim(vehicleLabelInput.value);
      const price = safeTrim(priceInfoInput.value);

      if (!url || !label) {
        alert(
          "Please paste a URL and hit Boost at least once before generating design ideas."
        );
        return;
      }

      designButton.disabled = true;
      const oldText = designButton.innerHTML;
      designButton.innerHTML =
        '<span class="icon">‚è≥</span><span>Designing‚Ä¶</span>';

      try {
        const resp = await callJson("/api/design-idea", {
          type,
          url,
          label,
          price,
        });
        if (!resp.success) throw new Error("API error");
        designOutput.value = resp.design || "";
      } catch (err) {
        console.error(err);
        alert("Error generating a design idea. Try again.");
      } finally {
        designButton.disabled = false;
        designButton.innerHTML = oldText;
      }
    });

    function openObjectionModal() {
      objectionModal.classList.remove("hidden");
      if (!objectionMessages.length) {
        renderObjectionChat();
      }
      setTimeout(() => {
        objectionInput.focus();
      }, 50);
    }

    function closeObjectionModal() {
      objectionModal.classList.add("hidden");
    }

    objectionLauncher.addEventListener("click", openObjectionModal);
    objectionCloseButton.addEventListener("click", closeObjectionModal);
    objectionModal.addEventListener("click", (e) => {
      if (e.target === objectionModal) closeObjectionModal();
    });

    function sendObjection() {
      const text = (objectionInput.value || "").trim();
      if (!text) {
        alert("Type the customer‚Äôs objection or your question first.");
        return;
      }

      const label = safeTrim(vehicleLabelInput.value) || "this vehicle";
      const price =
        safeTrim(priceInfoInput.value) || "Message for current pricing";

      objectionMessages.push({ role: "user", content: text });
      renderObjectionChat();
      objectionInput.value = "";

      objectionSendButton.disabled = true;
      const oldText = objectionSendButton.innerHTML;
      objectionSendButton.innerHTML = "<span>‚è≥ Coaching‚Ä¶</span>";

      callJson("/api/objection-coach", {
        messages: objectionMessages,
        label,
        price,
      })
        .then((resp) => {
          if (!resp.success) throw new Error("API error");
          const reply = resp.reply || "";
          objectionMessages.push({ role: "assistant", content: reply });
          renderObjectionChat();
        })
        .catch((err) => {
          console.error(err);
          alert("Error generating a response. Try again.");
        })
        .finally(() => {
          objectionSendButton.disabled = false;
          objectionSendButton.innerHTML = oldText;
        });
    }

    objectionSendButton.addEventListener("click", sendObjection);
    objectionInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && (e.metaKey || e.ctrlKey)) {
        e.preventDefault();
        sendObjection();
      }
    });

    // CALCULATOR MODAL OPEN/CLOSE
    function openCalcModal() {
      calcModal.classList.remove("hidden");
    }
    function closeCalcModal() {
      calcModal.classList.add("hidden");
    }
    calcLauncher.addEventListener("click", openCalcModal);
    calcCloseButton.addEventListener("click", closeCalcModal);
    calcModal.addEventListener("click", (e) => {
      if (e.target === calcModal) closeCalcModal();
    });

    // CALCULATOR LOGIC
    function fmtMoney(n) {
      return "$" + (n || 0).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // Payment
    document
      .getElementById("paymentForm")
      .addEventListener("submit", (e) => {
        e.preventDefault();
        const price = Number(
          document.getElementById("payPrice").value || 0
        );
        const down = Number(
          document.getElementById("payDown").value || 0
        );
        const term = Number(
          document.getElementById("payTerm").value || 0
        );
        const apr = Number(
          document.getElementById("payApr").value || 0
        );

        const principal = Math.max(price - down, 0);
        const r = apr > 0 ? apr / 100 / 12 : 0;
        let payment = 0;

        if (!term || !principal) {
          document.getElementById("payResult").textContent =
            "Missing info";
          return;
        }

        if (r === 0) {
          payment = principal / term;
        } else {
          const pow = Math.pow(1 + r, term);
          payment = (r * pow * principal) / (pow - 1);
        }

        document.getElementById("payResult").textContent =
          fmtMoney(payment) + " / mo";
      });

    // Affordability
    document
      .getElementById("affordForm")
      .addEventListener("submit", (e) => {
        e.preventDefault();
        const budget = Number(
          document.getElementById("affBudget").value || 0
        );
        const term = Number(
          document.getElementById("affTerm").value || 0
        );
        const apr = Number(
          document.getElementById("affApr").value || 0
        );

        const r = apr > 0 ? apr / 100 / 12 : 0;
        let principal = 0;

        if (!budget || !term) {
          document.getElementById("affResult").textContent =
            "Max price: $0";
          return;
        }

        if (r === 0) {
          principal = budget * term;
        } else {
          const pow = Math.pow(1 + r, term);
          principal = (budget * (pow - 1)) / (r * pow);
        }

        document.getElementById("affResult").textContent =
          "Max price: " + fmtMoney(principal);
      });

    // Income builder
    document
      .getElementById("incomeForm")
      .addEventListener("submit", (e) => {
        e.preventDefault();
        const goal = Number(
          document.getElementById("incGoal").value || 0
        );
        const perDeal = Number(
          document.getElementById("incPerDeal").value || 0
        );
        const days = Number(
          document.getElementById("incDays").value || 0
        );
        const closeRate = Number(
          document.getElementById("incClose").value || 0
        );

        if (!goal || !perDeal || !days || !closeRate) {
          document.getElementById("incResult").textContent =
            "Fill all fields.";
          return;
        }

        const dealsPerMonth = goal / perDeal;
        const dealsPerDay = dealsPerMonth / days;
        const showsPerDay = dealsPerDay / (closeRate / 100 || 1);
        const apptsPerDay = showsPerDay * 1.3;

        document.getElementById("incResult").textContent =
          "Deals/mo: " +
          dealsPerMonth.toFixed(1) +
          " ¬∑ Deals/day: " +
          dealsPerDay.toFixed(2) +
          " ¬∑ Shows/day: " +
          showsPerDay.toFixed(2) +
          " ¬∑ Appts/day: " +
          apptsPerDay.toFixed(2);
      });

    renderObjectionChat();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>Lot Rocket ¬∑ Social Media Kit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg-dark: #05060a;
      --bg-dark-alt: #0c0f17;
      --bg-light: #f5f5f7;
      --bg-light-alt: #ffffff;
      --accent: #ff4b4b;
      --accent-soft: rgba(255, 75, 75, 0.15);
      --border-dark: #252836;
      --border-light: #d0d3dd;
      --text-dark: #f9fafb;
      --text-muted-dark: #9ca3af;
      --text-light: #111827;
      --text-muted-light: #6b7280;
      --card-radius: 18px;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.4);
      --shadow-soft-light: 0 18px 40px rgba(15, 23, 42, 0.18);
      --input-radius: 12px;
      --transition-fast: 0.18s ease-out;
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        sans-serif;
    }

    [data-theme="dark"] body {
      background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
      color: var(--text-dark);
    }
    [data-theme="light"] body {
      background: radial-gradient(circle at top, #e5e7eb 0, #f9fafb 40%, #e5e7eb 100%);
      color: var(--text-light);
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font-main);
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 24px;
      box-sizing: border-box;
    }

    .app-shell {
      width: 100%;
      max-width: 1240px;
      border-radius: 26px;
      padding: 20px 22px 26px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 14px;
      position: relative;
      overflow: hidden;
    }

    [data-theme="dark"] .app-shell {
      background: radial-gradient(circle at top left, #1f2937 0, #020617 60%);
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }
    [data-theme="light"] .app-shell {
      background: linear-gradient(135deg, #f9fafb, #e5e7eb);
      box-shadow: var(--shadow-soft-light);
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .title-group {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-circle {
      width: 70px;
      height: 70px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-sizing: border-box;
    }
    [data-theme="dark"] .logo-circle {
      border: 2px solid #ef4444;
      color: #ef4444;
      background: radial-gradient(
        circle at center,
        rgba(239, 68, 68, 0.08),
        transparent 60%
      );
    }
    [data-theme="light"] .logo-circle {
      border: 2px solid #b91c1c;
      color: #b91c1c;
      background: #fff;
    }
    .logo-inner {
      font-weight: 800;
      font-size: 30px;
      line-height: 1;
      position: relative;
      font-family: "Times New Roman", Georgia, serif;
    }
    .logo-inner span.rocket {
      position: absolute;
      left: 52%;
      top: 32%;
      font-size: 16px;
      transform: translateX(-50%);
    }
    .logo-text-main {
      font-weight: 700;
      font-size: 18px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }
    .logo-text-sub {
      font-size: 13px;
      opacity: 0.78;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
    }

    .chip {
      padding: 5px 10px;
      border-radius: 999px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    [data-theme="dark"] .chip {
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-muted-dark);
    }
    [data-theme="light"] .chip {
      background: rgba(255, 255, 255, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-muted-light);
    }
    .chip span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15);
    }

    .theme-toggle {
      border-radius: 999px;
      padding: 6px 10px;
      border: none;
      cursor: pointer;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background var(--transition-fast), transform var(--transition-fast),
        box-shadow var(--transition-fast), color var(--transition-fast);
    }
    [data-theme="dark"] .theme-toggle {
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-muted-dark);
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.45);
    }
    [data-theme="light"] .theme-toggle {
      background: rgba(255, 255, 255, 0.95);
      color: var(--text-muted-light);
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.5);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 0.95fr) minmax(0, 1.3fr);
      gap: 16px;
      margin-top: 6px;
    }
    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      border-radius: var(--card-radius);
      padding: 14px 14px 13px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
    }
    [data-theme="dark"] .card {
      background: radial-gradient(circle at top left, #111827 0, #020617 60%);
      border: 1px solid rgba(51, 65, 85, 0.9);
    }
    [data-theme="light"] .card {
      background: rgba(255, 255, 255, 0.92);
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .card-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
    }
    .card-title {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    .card-subtitle {
      font-size: 12px;
      opacity: 0.75;
    }

    .badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    [data-theme="dark"] .badge {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(107, 114, 128, 0.9);
      color: var(--text-muted-dark);
    }
    [data-theme="light"] .badge {
      background: rgba(249, 250, 251, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.9);
      color: var(--text-muted-light);
    }

    label.field-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.8;
      margin-bottom: 4px;
      display: block;
    }

    .field-group {
      margin-bottom: 8px;
    }

    .input,
    .textarea {
      width: 100%;
      box-sizing: border-box;
      border-radius: var(--input-radius);
      border: 1px solid;
      padding: 7px 9px;
      font-family: var(--font-main);
      font-size: 13px;
      resize: vertical;
      min-height: 34px;
      outline: none;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast),
        background var(--transition-fast), color var(--transition-fast);
    }
    .textarea {
      white-space: pre-wrap;
    }

    [data-theme="dark"] .input,
    [data-theme="dark"] .textarea {
      background: rgba(15, 23, 42, 0.95);
      border-color: rgba(55, 65, 81, 0.95);
      color: var(--text-dark);
    }
    [data-theme="light"] .input,
    [data-theme="light"] .textarea {
      background: rgba(249, 250, 251, 0.96);
      border-color: rgba(148, 163, 184, 0.9);
      color: var(--text-light);
    }

    .input:focus,
    .textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.5);
    }

    .button-primary {
      border-radius: 999px;
      padding: 7px 16px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast),
        background var(--transition-fast);
    }
    [data-theme="dark"] .button-primary {
      background: linear-gradient(135deg, #fb923c, #ef4444);
      color: #fff;
      box-shadow: 0 14px 30px rgba(248, 113, 113, 0.7);
    }
    [data-theme="light"] .button-primary {
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: #fff;
      box-shadow: 0 12px 26px rgba(239, 68, 68, 0.6);
    }
    .button-primary:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: none;
    }

    .button-ghost {
      border-radius: 999px;
      padding: 5px 10px;
      border: 1px solid;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: transparent;
      transition: background var(--transition-fast), border-color var(--transition-fast),
        color var(--transition-fast);
    }
    [data-theme="dark"] .button-ghost {
      border-color: rgba(75, 85, 99, 0.85);
      color: var(--text-muted-dark);
    }
    [data-theme="light"] .button-ghost {
      border-color: rgba(148, 163, 184, 0.9);
      color: var(--text-muted-light);
    }
    .button-ghost span.icon {
      font-size: 13px;
    }

    .stack-vertical {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .pill-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: flex-start;
    }

    .pill {
      border-radius: 999px;
      padding: 5px 9px;
      font-size: 11px;
      border: 1px solid;
    }
    [data-theme="dark"] .pill {
      background: rgba(15, 23, 42, 0.9);
      border-color: rgba(55, 65, 81, 0.9);
      color: var(--text-muted-dark);
    }
    [data-theme="light"] .pill {
      background: rgba(249, 250, 251, 0.96);
      border-color: rgba(148, 163, 184, 0.9);
      color: var(--text-muted-light);
    }

    .photos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 6px;
    }
    .photo-thumb {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      aspect-ratio: 4 / 3;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }
    .photo-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .status-text {
      font-size: 11px;
      opacity: 0.8;
    }

    .section-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .social-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }
    @media (max-width: 900px) {
      .social-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .social-card {
      border-radius: 16px;
      padding: 10px 11px 9px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      border: 1px solid rgba(148, 163, 184, 0.75);
      min-height: 200px;
    }
    [data-theme="dark"] .social-card {
      background: rgba(15, 23, 42, 0.98);
    }
    [data-theme="light"] .social-card {
      background: rgba(249, 250, 251, 0.98);
    }

    .social-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    .social-platform {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .textarea.post-box {
      min-height: 210px;
      max-height: 260px;
      font-size: 13px;
      line-height: 1.35;
    }

    .textarea.marketplace-box {
      min-height: 230px;
      max-height: 280px;
    }

    .textarea.script {
      min-height: 160px;
    }

    .textarea.shotplan {
      min-height: 130px;
    }

    .textarea.design {
      min-height: 180px;
    }

    .tiny-note {
      font-size: 10px;
      opacity: 0.75;
      margin-top: 4px;
    }

    .loading-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      display: inline-block;
      margin-right: 4px;
      animation: pulse 1s infinite alternate;
    }
    @keyframes pulse {
      from {
        transform: scale(1);
        opacity: 0.8;
      }
      to {
        transform: scale(1.4);
        opacity: 0.3;
      }
    }

    .hidden {
      display: none !important;
    }

    /* Objection modal (unchanged) */

    .objection-modal-backdrop {
      position: fixed;
      inset: 0;
      z-index: 70;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.78);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    .objection-modal-card {
      width: 620px;
      max-width: 96vw;
      max-height: 82vh;
      border-radius: 20px;
      padding: 14px 14px 12px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    [data-theme="dark"] .objection-modal-card {
      background: radial-gradient(circle at top, #111827 0, #020617 60%);
      border: 1px solid rgba(248, 113, 113, 0.8);
      box-shadow: 0 22px 55px rgba(0, 0, 0, 0.9);
      color: var(--text-dark);
    }
    [data-theme="light"] .objection-modal-card {
      background: #f9fafb;
      border: 1px solid rgba(248, 113, 113, 0.9);
      box-shadow: 0 22px 55px rgba(15, 23, 42, 0.35);
      color: var(--text-light);
    }

    .objection-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    .objection-modal-title-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .objection-modal-tag {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      opacity: 0.8;
    }
    .objection-modal-title {
      font-size: 14px;
      font-weight: 600;
    }
    .objection-modal-sub {
      font-size: 11px;
      opacity: 0.8;
    }

    .objection-modal-close {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: transparent;
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
    }

    .objection-chat-area {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
      flex: 1 1 auto;
      min-height: 0;
    }

    .objection-history {
      flex: 1 1 auto;
      min-height: 160px;
      max-height: 330px;
      border-radius: 12px;
      padding: 8px 9px;
      box-sizing: border-box;
      overflow-y: auto;
      font-size: 12px;
      line-height: 1.4;
      border: 1px solid rgba(148, 163, 184, 0.8);
    }
    [data-theme="dark"] .objection-history {
      background: rgba(15, 23, 42, 0.96);
    }
    [data-theme="light"] .objection-history {
      background: rgba(249, 250, 251, 0.98);
    }

    .objection-bubble {
      margin-bottom: 6px;
      padding: 6px 8px;
      border-radius: 10px;
      white-space: pre-wrap;
    }
    .objection-bubble.you-label,
    .objection-bubble.coach-label {
      font-weight: 600;
      font-size: 11px;
      opacity: 0.8;
      margin-bottom: 2px;
      padding: 0;
    }

    [data-theme="dark"] .objection-bubble.you {
      background: rgba(37, 99, 235, 0.32);
      border: 1px solid rgba(59, 130, 246, 0.7);
    }
    [data-theme="light"] .objection-bubble.you {
      background: rgba(191, 219, 254, 0.7);
      border: 1px solid rgba(59, 130, 246, 0.8);
    }
    [data-theme="dark"] .objection-bubble.coach {
      background: rgba(248, 113, 113, 0.22);
      border: 1px solid rgba(248, 113, 113, 0.8);
    }
    [data-theme="light"] .objection-bubble.coach {
      background: rgba(254, 226, 226, 0.92);
      border: 1px solid rgba(248, 113, 113, 0.9);
    }

    .objection-input-row {
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-top: 4px;
    }

    .objection-input-box {
      width: 100%;
      box-sizing: border-box;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      font-family: var(--font-main);
      font-size: 12px;
      padding: 7px 8px;
      resize: vertical;
      min-height: 54px;
    }
    [data-theme="dark"] .objection-input-box {
      background: rgba(15, 23, 42, 0.98);
      color: var(--text-dark);
    }
    [data-theme="light"] .objection-input-box {
      background: rgba(249, 250, 251, 0.98);
      color: var(--text-light);
    }

    .objection-send-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 2px;
    }
    .objection-hint {
      font-size: 10px;
      opacity: 0.8;
    }

    #objectionSendButton {
      border-radius: 999px;
      border: none;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 6px 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    [data-theme="dark"] #objectionSendButton {
      background: linear-gradient(135deg, #fb923c, #ef4444);
      color: #fff;
      box-shadow: 0 10px 22px rgba(248, 113, 113, 0.7);
    }
    [data-theme="light"] #objectionSendButton {
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: #fff;
      box-shadow: 0 10px 22px rgba(239, 68, 68, 0.6);
    }

    @media (max-width: 640px) {
      .objection-modal-card {
        width: 100%;
        margin: 0 10px;
        max-height: 86vh;
      }
    }

    /* ===========================
       SIDE LAUNCHER BUTTONS
       =========================== */

    .side-launcher-wrapper {
      position: absolute;
      top: 220px;   /* adjust up/down if needed */
      right: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 60;
    }

    .side-launcher-btn {
      min-width: 180px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7eb;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      justify-content: flex-start;
      gap: 8px;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }

    .side-launcher-btn .icon {
      font-size: 14px;
    }

    .side-launcher-btn:hover {
      border-color: rgba(248, 113, 113, 0.9);
    }

    [data-theme="light"] .side-launcher-btn {
      background: rgba(255, 255, 255, 0.96);
      color: #111827;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.25);
    }

    @media (max-width: 1024px) {
      .side-launcher-wrapper {
        position: static;
        margin-top: 10px;
        flex-direction: row;
        justify-content: flex-end;
      }
    }

    /* ===========================
       CALCULATOR MODAL
       =========================== */

    .calc-modal-backdrop {
      position: fixed;
      inset: 0;
      z-index: 70;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.78);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    .calc-modal-card {
      width: 800px;
      max-width: 96vw;
      max-height: 86vh;
      border-radius: 20px;
      padding: 14px 14px 12px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    [data-theme="dark"] .calc-modal-card {
      background: radial-gradient(circle at top, #020617 0, #020617 60%);
      border: 1px solid rgba(148, 163, 184, 0.9);
      box-shadow: 0 22px 55px rgba(0, 0, 0, 0.9);
      color: var(--text-dark);
    }
    [data-theme="light"] .calc-modal-card {
      background: #f9fafb;
      border: 1px solid rgba(148, 163, 184, 0.9);
      box-shadow: 0 22px 55px rgba(15, 23, 42, 0.35);
      color: var(--text-light);
    }

    .calc-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .calc-modal-title-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .calc-modal-title {
      font-size: 14px;
      font-weight: 600;
    }

    .calc-modal-sub {
      font-size: 11px;
      opacity: 0.8;
    }

    .calc-modal-close {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: transparent;
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
    }

    .calc-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 6px;
    }
    @media (max-width: 900px) {
      .calc-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .calc-card {
      border-radius: 14px;
      padding: 10px 11px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 6px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      font-size: 12px;
    }
    [data-theme="dark"] .calc-card {
      background: rgba(15, 23, 42, 0.96);
    }
    [data-theme="light"] .calc-card {
      background: rgba(249, 250, 251, 0.98);
    }

    .calc-card h3 {
      margin: 0;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .calc-field-row {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-bottom: 4px;
    }

    .calc-field-row label {
      font-size: 11px;
    }

    .calc-result {
      margin-top: 4px;
      font-size: 12px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="title-group">
        <div class="logo-circle">
          <div class="logo-inner">
            LR
            <span class="rocket">üöÄ</span>
          </div>
        </div>
        <div>
          <div class="logo-text-main">Lot Rocket</div>
          <div class="logo-text-sub">
            Social Media Kit ¬∑ Prototype for salespeople, not stores
          </div>
        </div>
      </div>
      <div class="header-right">
        <div class="chip">
          <span class="dot"></span>
          <span>AI-ASSISTED COPY ¬∑ BETA</span>
        </div>
        <button id="themeToggle" class="theme-toggle" type="button">
          <span id="themeIcon">üåô</span>
          <span id="themeLabel">Dark</span>
        </button>
      </div>
    </header>

    <div class="layout">
      <!-- LEFT: STEP 1 -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Step 1 ¬∑ Dealer URL</div>
            <div class="card-subtitle">
              Paste a full vehicle detail page. We‚Äôll pull photos and build the kit.
            </div>
          </div>
          <span class="badge">INPUT</span>
        </div>

        <div class="stack-vertical">
          <div class="field-group">
            <label class="field-label" for="vehicleUrl">Dealer vehicle URL</label>
            <input
              id="vehicleUrl"
              class="input"
              placeholder="https://dealer.com/used-YourVehicleHere..."
            />
          </div>

          <div class="pill-row">
            <button id="boostButton" class="button-primary" type="button">
              <span>üöÄ Boost This Listing</span>
            </button>
            <span id="statusText" class="status-text"
              >Paste URL, then tap Boost.</span
            >
          </div>

          <div class="field-group">
            <label class="field-label" for="vehicleLabel">Vehicle label (editable)</label>
            <input
              id="vehicleLabel"
              class="input"
              placeholder="2024 Chevrolet Blazer 2LT ‚Äì Plymouth, MI ‚Äì Used"
            />
          </div>

          <div class="field-group">
            <label class="field-label" for="priceInfo">Price / deal info (editable)</label>
            <input
              id="priceInfo"
              class="input"
              placeholder="Message for current pricing"
            />
          </div>
        </div>

        <div class="stack-vertical">
          <div class="section-title-row">
            <div>
              <div class="card-title">Media Tools</div>
              <div class="card-subtitle">
                We‚Äôll auto-pull photos on Boost and turn them into a simple video
                plan.
              </div>
            </div>
            <button id="buildVideoButton" class="button-ghost" type="button">
              <span class="icon">üé¨</span><span>Build Video from Photos</span>
            </button>
          </div>

          <div class="field-group">
            <label class="field-label">Dealer Photos</label>
            <div id="photosGrid" class="photos-grid"></div>
            <div id="photosStatus" class="tiny-note">
              Photos will auto-load after Boost if we can find them.
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="videoPlan">Video From Photos Plan</label>
            <textarea
              id="videoPlan"
              class="textarea shotplan"
              placeholder="Hit 'Build Video from Photos' after photos load to get a simple shot list for Reels / TikTok."
              readonly
            ></textarea>
          </div>
        </div>
      </section>

      <!-- RIGHT: STEP 2 -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Step 2 ¬∑ Social Kit</div>
            <div class="card-subtitle">
              Copy, tweak, and paste into each platform. Spin fresh versions anytime.
            </div>
          </div>
          <span class="badge">OUTPUT</span>
        </div>

        <div class="stack-vertical">
          <div class="field-group">
            <label class="field-label">Listing Summary</label>
            <div class="pill-row">
              <span id="summaryLabel" class="pill">No vehicle yet</span>
              <span id="summaryPrice" class="pill">‚Äî</span>
            </div>
          </div>

          <div class="field-group">
            <label class="field-label">Social Media Posts</label>
            <div class="card-subtitle">
              Each box is copy-and-paste ready. Hit ‚ÄúNew Post‚Äù to spin a fresh
              version for that platform.
            </div>
          </div>

          <div class="social-grid">
            <!-- Facebook -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üìò Facebook</div>
                <button
                  data-platform="facebook"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Post</span>
                </button>
              </div>
              <textarea id="facebookPost" class="textarea post-box" readonly></textarea>
            </div>

            <!-- Instagram -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üì∏ Instagram</div>
                <button
                  data-platform="instagram"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Post</span>
                </button>
              </div>
              <textarea
                id="instagramPost"
                class="textarea post-box"
                readonly
              ></textarea>
            </div>

            <!-- TikTok -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üéµ TikTok</div>
                <button
                  data-platform="tiktok"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Post</span>
                </button>
              </div>
              <textarea id="tiktokPost" class="textarea post-box" readonly></textarea>
            </div>

            <!-- LinkedIn -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üíº LinkedIn</div>
                <button
                  data-platform="linkedin"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Post</span>
                </button>
              </div>
              <textarea
                id="linkedinPost"
                class="textarea post-box"
                readonly
              ></textarea>
            </div>

            <!-- Twitter -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üê¶ X / Twitter</div>
                <button
                  data-platform="twitter"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Post</span>
                </button>
              </div>
              <textarea id="twitterPost" class="textarea post-box" readonly></textarea>
            </div>

            <!-- Text / DM -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üí¨ Text / DM</div>
                <button
                  data-platform="text"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Text</span>
                </button>
              </div>
              <textarea id="textBlurb" class="textarea post-box" readonly></textarea>
            </div>

            <!-- Marketplace -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üõí Marketplace</div>
                <button
                  data-platform="marketplace"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Post</span>
                </button>
              </div>
              <textarea
                id="marketplacePost"
                class="textarea marketplace-box"
                readonly
              ></textarea>
            </div>

            <!-- Hashtags -->
            <div class="social-card">
              <div class="social-card-header">
                <div class="social-platform">üè∑ Hashtags</div>
                <button
                  data-platform="hashtags"
                  class="button-ghost button-new-post"
                  type="button"
                >
                  <span class="icon">üîÅ</span><span>New Tags</span>
                </button>
              </div>
              <textarea id="hashtags" class="textarea post-box" readonly></textarea>
            </div>
          </div>

          <div class="field-group">
            <div class="section-title-row">
              <label class="field-label">Video Engine</label>
              <button id="newScriptButton" class="button-ghost" type="button">
                <span class="icon">üîÅ</span><span>New Script</span>
              </button>
            </div>
            <div class="card-subtitle">
              Script + shot plan you can read on camera and follow for Reels, TikTok,
              Shorts, or Facebook Reels.
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="videoScript">Viral Video Script</label>
            <textarea
              id="videoScript"
              class="textarea script"
              readonly
            ></textarea>
          </div>

          <div class="field-group">
            <label class="field-label" for="shotPlan">Viral Visual Shot Plan</label>
            <textarea
              id="shotPlan"
              class="textarea shotplan"
              readonly
            ></textarea>
          </div>

          <div class="field-group">
            <div class="section-title-row">
              <label class="field-label">Design Lab (Canva-style layout)</label>
              <div class="card-subtitle">
                Get a ready-to-build graphic layout you can recreate in Canva.
              </div>
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="designType">Design Type</label>
            <div class="pill-row">
              <select
                id="designType"
                class="input"
                style="max-width: 260px; padding-right: 28px"
              >
                <option value="facebook_feed_post">Facebook feed post</option>
                <option value="instagram_feed_post">
                  Instagram feed post
                </option>
                <option value="instagram_story">Instagram Story</option>
                <option value="reels_cover">Reels / TikTok cover image</option>
                <option value="tiktok_vertical_graphic">
                  TikTok vertical graphic
                </option>
                <option value="youtube_thumbnail">YouTube thumbnail</option>
              </select>
              <button id="designButton" class="button-ghost" type="button">
                <span class="icon">üé®</span><span>Generate Design Idea</span>
              </button>
            </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="designOutput">Design Layout Plan</label>
            <textarea
              id="designOutput"
              class="textarea design"
              placeholder="Choose a design type and hit Generate to get a Canva-style layout you can build in minutes."
              readonly
            ></textarea>
          </div>

          <div class="tiny-note">
            Prototype for salespeople. Copy, tweak, and make it yours. üöÄ
          </div>
        </div>
      </section>
    </div>

    <!-- SIDE LAUNCHER BUTTONS -->
    <div class="side-launcher-wrapper">
      <button id="objectionLauncher" class="side-launcher-btn" type="button">
        <span class="icon">üß†</span>
        <span>Objection coach</span>
      </button>
      <button id="calcLauncher" class="side-launcher-btn" type="button">
        <span class="icon">üìä</span>
        <span>Calculators</span>
      </button>
    </div>
  </div>

  <!-- OBJECTION COACH MODAL -->
  <div id="objectionModal" class="objection-modal-backdrop hidden">
    <div class="objection-modal-card">
      <div class="objection-modal-header">
        <div class="objection-modal-title-group">
          <div class="objection-modal-tag">OBJECTIONS HANDLED</div>
          <div class="objection-modal-title">Andy Elliott‚Äìstyle AI coach</div>
          <div class="objection-modal-sub">
            Paste a customer objection or ask how to respond. Get word tracks and
            breakdowns.
          </div>
        </div>
        <button
          id="objectionCloseButton"
          class="objection-modal-close"
          type="button"
        >
          ‚úï
        </button>
      </div>

      <div class="objection-chat-area">
        <div id="objectionHistory" class="objection-history"></div>

        <div class="objection-input-row">
          <textarea
            id="objectionInput"
            class="objection-input-box"
            placeholder='Example: "I need to think about it" or "Payment is too high" or ask: "How do I close a be-back?"'
          ></textarea>

          <div class="objection-send-row">
            <div class="objection-hint">
              Tip: Enter to make a new line. Ctrl+Enter / Cmd+Enter to send fast.
            </div>
            <button id="objectionSendButton" type="button">
              <span>üß† Handle this objection</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CALCULATOR MODAL -->
  <div id="calcModal" class="calc-modal-backdrop hidden">
    <div class="calc-modal-card">
      <div class="calc-modal-header">
        <div class="calc-modal-title-group">
          <div class="calc-modal-title">Deal Desk Calculators</div>
          <div class="calc-modal-sub">
            Quick numbers you can share with a customer on the spot.
          </div>
        </div>
        <button id="calcCloseButton" class="calc-modal-close" type="button">
          ‚úï
        </button>
      </div>

      <div class="calc-grid">
        <!-- Payment Calculator -->
        <div class="calc-card">
          <h3>Payment</h3>
          <form id="paymentForm">
            <div class="calc-field-row">
              <label for="payPrice">Vehicle price</label>
              <input
                id="payPrice"
                class="input"
                type="number"
                min="0"
                step="100"
                placeholder="35000"
              />
            </div>
            <div class="calc-field-row">
              <label for="payDown">Down payment</label>
              <input
                id="payDown"
                class="input"
                type="number"
                min="0"
                step="100"
                placeholder="2000"
              />
            </div>
            <div class="calc-field-row">
              <label for="payTerm">Term (months)</label>
              <input
                id="payTerm"
                class="input"
                type="number"
                min="12"
                step="12"
                placeholder="72"
              />
            </div>
            <div class="calc-field-row">
              <label for="payApr">APR %</label>
              <input
                id="payApr"
                class="input"
                type="number"
                min="0"
                step="0.1"
                placeholder="7.5"
              />
            </div>
            <button class="button-ghost" type="submit">
              <span class="icon">üßÆ</span><span>Calculate</span>
            </button>
          </form>
          <div class="calc-result" id="payResult">$0.00 / mo</div>
        </div>

        <!-- Affordability -->
        <div class="calc-card">
          <h3>Affordability</h3>
          <form id="affordForm">
            <div class="calc-field-row">
              <label for="affBudget">Max monthly budget</label>
              <input
                id="affBudget"
                class="input"
                type="number"
                min="0"
                step="50"
                placeholder="450"
              />
            </div>
            <div class="calc-field-row">
              <label for="affTerm">Term (months)</label>
              <input
                id="affTerm"
                class="input"
                type="number"
                min="12"
                step="12"
                placeholder="72"
              />
            </div>
            <div class="calc-field-row">
              <label for="affApr">APR %</label>
              <input
                id="affApr"
                class="input"
                type="number"
                min="0"
                step="0.1"
                placeholder="7.5"
              />
            </div>
            <button class="button-ghost" type="submit">
              <span class="icon">üìà</span><span>Estimate</span>
            </button>
          </form>
          <div class="calc-result" id="affResult">Max price: $0</div>
        </div>

        <!-- Income Builder -->
        <div class="calc-card">
          <h3>Income Builder</h3>
          <form id="incomeForm">
            <div class="calc-field-row">
              <label for="incGoal">Monthly income goal ($)</label>
              <input
                id="incGoal"
                class="input"
                type="number"
                min="0"
                step="500"
                placeholder="10000"
              />
            </div>
            <div class="calc-field-row">
              <label for="incPerDeal">Average per deal ($)</label>
              <input
                id="incPerDeal"
                class="input"
                type="number"
                min="0"
                step="50"
                placeholder="500"
              />
            </div>
            <div class="calc-field-row">
              <label for="incDays">Work days per month</label>
              <input
                id="incDays"
                class="input"
                type="number"
                min="10"
                max="31"
                step="1"
                placeholder="24"
              />
            </div>
            <div class="calc-field-row">
              <label for="incClose">Close rate %</label>
              <input
                id="incClose"
                class="input"
                type="number"
                min="1"
                max="100"
                step="1"
                placeholder="20"
              />
            </div>
            <button class="button-ghost" type="submit">
              <span class="icon">üìä</span><span>Build plan</span>
            </button>
          </form>
          <div class="calc-result" id="incResult">
            Deals/mo: 0 ¬∑ Deals/day: 0 ¬∑ Shows/day: 0 ¬∑ Appts/day: 0
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const apiBase = "";

    const vehicleUrlInput = document.getElementById("vehicleUrl");
    const vehicleLabelInput = document.getElementById("vehicleLabel");
    const priceInfoInput = document.getElementById("priceInfo");
    const boostButton = document.getElementById("boostButton");
    const statusText = document.getElementById("statusText");

    const summaryLabel = document.getElementById("summaryLabel");
    const summaryPrice = document.getElementById("summaryPrice");

    const facebookPost = document.getElementById("facebookPost");
    const instagramPost = document.getElementById("instagramPost");
    const tiktokPost = document.getElementById("tiktokPost");
    const linkedinPost = document.getElementById("linkedinPost");
    const twitterPost = document.getElementById("twitterPost");
    const textBlurb = document.getElementById("textBlurb");
    const marketplacePost = document.getElementById("marketplacePost");
    const hashtags = document.getElementById("hashtags");
    const videoScript = document.getElementById("videoScript");
    const shotPlan = document.getElementById("shotPlan");

    const buildVideoButton = document.getElementById("buildVideoButton");
    const photosGrid = document.getElementById("photosGrid");
    const photosStatus = document.getElementById("photosStatus");
    const videoPlan = document.getElementById("videoPlan");

    const newScriptButton = document.getElementById("newScriptButton");

    const designTypeSelect = document.getElementById("designType");
    const designButton = document.getElementById("designButton");
    const designOutput = document.getElementById("designOutput");

    const themeToggle = document.getElementById("themeToggle");
    const themeIcon = document.getElementById("themeIcon");
    const themeLabel = document.getElementById("themeLabel");

    const objectionLauncher = document.getElementById("objectionLauncher");
    const objectionModal = document.getElementById("objectionModal");
    const objectionCloseButton = document.getElementById("objectionCloseButton");
    const objectionHistory = document.getElementById("objectionHistory");
    const objectionInput = document.getElementById("objectionInput");
    const objectionSendButton = document.getElementById("objectionSendButton");

    const calcLauncher = document.getElementById("calcLauncher");
    const calcModal = document.getElementById("calcModal");
    const calcCloseButton = document.getElementById("calcCloseButton");

    let currentPhotos = [];
    let currentUrl = "";
    let isBoosting = false;

    let objectionMessages = [];

    function applyTheme(theme) {
      const root = document.documentElement;
      root.setAttribute("data-theme", theme);
      if (theme === "dark") {
        themeIcon.textContent = "üåô";
        themeLabel.textContent = "Dark";
      } else {
        themeIcon.textContent = "‚òÄÔ∏è";
        themeLabel.textContent = "Light";
      }
      localStorage.setItem("lotRocketTheme", theme);
    }

    function initTheme() {
      const saved = localStorage.getItem("lotRocketTheme");
      if (saved === "light" || saved === "dark") {
        applyTheme(saved);
      } else {
        applyTheme("dark");
      }
    }

    themeToggle.addEventListener("click", () => {
      const current =
        document.documentElement.getAttribute("data-theme") || "dark";
      const next = current === "dark" ? "light" : "dark";
      applyTheme(next);
    });

    initTheme();

    function setStatus(text, isLoading = false) {
      if (isLoading) {
        statusText.innerHTML =
          '<span class="loading-dot"></span>' + text;
      } else {
        statusText.textContent = text;
      }
    }

    function safeTrim(str) {
      return (str || "").toString().trim();
    }

    function updateSummary(label, price) {
      summaryLabel.textContent = safeTrim(label) || "Vehicle ready";
      summaryPrice.textContent =
        safeTrim(price) || "Message for current pricing";
    }

    function fillSocialKit(kit) {
      facebookPost.value = kit.facebook || "";
      instagramPost.value = kit.instagram || "";
      tiktokPost.value = kit.tiktok || "";
      linkedinPost.value = kit.linkedin || "";
      twitterPost.value = kit.twitter || "";
      textBlurb.value = kit.textBlurb || "";
      marketplacePost.value = kit.marketplace || "";
      hashtags.value = kit.hashtags || "";
      videoScript.value = kit.videoScript || "";
      shotPlan.value = kit.shotPlan || "";
    }

    function renderPhotosGrid(photos) {
      photosGrid.innerHTML = "";
      if (!photos || !photos.length) {
        photosStatus.textContent = "No photos found yet.";
        return;
      }
      photos.forEach((url) => {
        const wrapper = document.createElement("div");
        wrapper.className = "photo-thumb";
        const img = document.createElement("img");
        img.src = url;
        img.alt = "Vehicle photo";
        wrapper.appendChild(img);
        wrapper.addEventListener("click", () => {
          window.open(url, "_blank");
        });
        photosGrid.appendChild(wrapper);
      });
      photosStatus.textContent =
        photos.length + " photos found. Click any to open full size.";
    }

    async function callJson(endpoint, body) {
      const res = await fetch(apiBase + endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body || {}),
      });
      if (!res.ok) {
        const txt = await res.text().catch(() => "");
        throw new Error("Request failed: " + res.status + " " + txt);
      }
      return res.json();
    }

    function renderObjectionChat() {
      objectionHistory.innerHTML = "";
      if (!objectionMessages.length) {
        const empty = document.createElement("div");
        empty.className = "objection-bubble";
        empty.style.opacity = "0.7";
        empty.textContent =
          "Paste the customer objection (or ask a question) and your Andy Elliott‚Äìstyle coach will give you word tracks and breakdowns.";
        objectionHistory.appendChild(empty);
        return;
      }

      objectionMessages.forEach((m) => {
        const labelDiv = document.createElement("div");
        labelDiv.className =
          "objection-bubble " +
          (m.role === "assistant" ? "coach-label" : "you-label");
        labelDiv.textContent =
          m.role === "assistant" ? "COACH" : "YOU";

        const bubble = document.createElement("div");
        bubble.className =
          "objection-bubble " +
          (m.role === "assistant" ? "coach" : "you");
        bubble.textContent = m.content || "";

        objectionHistory.appendChild(labelDiv);
        objectionHistory.appendChild(bubble);
      });

      objectionHistory.scrollTop = objectionHistory.scrollHeight;
    }

    async function handleBoost() {
      if (isBoosting) return;
      const url = safeTrim(vehicleUrlInput.value);
      if (!url) {
        alert("Paste a dealer vehicle URL first.");
        return;
      }

      let label = safeTrim(vehicleLabelInput.value);
      if (!label) {
        label = "This vehicle";
        vehicleLabelInput.value = label;
      }
      let price = safeTrim(priceInfoInput.value);
      if (!price) {
        price = "Message for current pricing";
        priceInfoInput.value = price;
      }

      isBoosting = true;
      boostButton.disabled = true;
      setStatus("Building social kit with AI‚Ä¶", true);

      try {
        currentUrl = url;
        const resp = await callJson("/api/social-kit", { url, label, price });
        if (!resp.success) throw new Error("API returned error");
        fillSocialKit(resp.kit);
        updateSummary(label, price);
        setStatus(
          "Social kit ready. You can spin new posts or scripts anytime."
        );

        objectionMessages = [];
        renderObjectionChat();

        try {
          photosStatus.textContent =
            "Trying to grab photos from dealer page‚Ä¶";
          const photoResp = await callJson("/api/grab-photos", { url });
          if (photoResp.success) {
            currentPhotos = photoResp.photos || [];
            renderPhotosGrid(currentPhotos);
          } else {
            photosStatus.textContent = "Could not grab photos.";
          }
        } catch (err) {
          console.error("Auto photo grab failed:", err);
          photosStatus.textContent = "Auto photo load failed.";
        }
      } catch (err) {
        console.error(err);
        setStatus("Something went wrong. Try again or check the URL.");
        alert("Error building social kit. Check the URL and try again.");
      } finally {
        isBoosting = false;
        boostButton.disabled = false;
      }
    }

    boostButton.addEventListener("click", handleBoost);

    document.querySelectorAll(".button-new-post").forEach((btn) => {
      btn.addEventListener("click", async () => {
        const platform = btn.getAttribute("data-platform");
        const url = safeTrim(vehicleUrlInput.value);
        const label = safeTrim(vehicleLabelInput.value);
        const price = safeTrim(priceInfoInput.value);

        if (!url || !label) {
          alert(
            "Please paste a URL and hit Boost at least once before spinning posts."
          );
          return;
        }

        btn.disabled = true;
        const oldText = btn.innerHTML;
        btn.innerHTML = '<span class="icon">‚è≥</span><span>Working‚Ä¶</span>';

        try {
          const resp = await callJson("/api/new-post", {
            platform,
            url,
            label,
            price,
          });
          if (!resp.success) throw new Error("API returned error");
          const text = resp.post || "";

          switch (platform) {
            case "facebook":
              facebookPost.value = text;
              break;
            case "instagram":
              instagramPost.value = text;
              break;
            case "tiktok":
              tiktokPost.value = text;
              break;
            case "linkedin":
              linkedinPost.value = text;
              break;
            case "twitter":
              twitterPost.value = text;
              break;
            case "text":
              textBlurb.value = text;
              break;
            case "marketplace":
              marketplacePost.value = text;
              break;
            case "hashtags":
              hashtags.value = text;
              break;
          }
        } catch (err) {
          console.error(err);
          alert("Error generating a new post. Try again.");
        } finally {
          btn.disabled = false;
          btn.innerHTML = oldText;
        }
      });
    });

    newScriptButton.addEventListener("click", async () => {
      const url = safeTrim(vehicleUrlInput.value);
      const label = safeTrim(vehicleLabelInput.value);
      const price = safeTrim(priceInfoInput.value);

      if (!url || !label) {
        alert(
          "Please paste a URL and hit Boost at least once before spinning scripts."
        );
        return;
      }

      newScriptButton.disabled = true;
      const oldText = newScriptButton.innerHTML;
      newScriptButton.innerHTML =
        '<span class="icon">‚è≥</span><span>Working‚Ä¶</span>';

      try {
        const resp = await callJson("/api/new-script", {
          url,
          label,
          price,
        });
        if (!resp.success) throw new Error("API error");
        videoScript.value = resp.script || "";
      } catch (err) {
        console.error(err);
        alert("Error generating a new script. Try again.");
      } finally {
        newScriptButton.disabled = false;
        newScriptButton.innerHTML = oldText;
      }
    });

    buildVideoButton.addEventListener("click", async () => {
      if (!currentPhotos || !currentPhotos.length) {
        alert("No photos yet. Boost a listing first so we can grab photos.");
        return;
      }

      buildVideoButton.disabled = true;
      const oldText = buildVideoButton.innerHTML;
      buildVideoButton.innerHTML =
        '<span class="icon">‚è≥</span><span>Building‚Ä¶</span>';

      try {
        const label = safeTrim(vehicleLabelInput.value) || "this vehicle";
        const resp = await callJson("/api/video-from-photos", {
          photos: currentPhotos,
          label,
        });
        if (!resp.success) throw new Error("API error");
        videoPlan.value = resp.plan || "";
      } catch (err) {
        console.error(err);
        alert("Error building video plan. Try again.");
      } finally {
        buildVideoButton.disabled = false;
        buildVideoButton.innerHTML = oldText;
      }
    });

    designButton.addEventListener("click", async () => {
      const type = designTypeSelect.value;
      const url = safeTrim(vehicleUrlInput.value);
      const label = safeTrim(vehicleLabelInput.value);
      const price = safeTrim(priceInfoInput.value);

      if (!url || !label) {
        alert(
          "Please paste a URL and hit Boost at least once before generating design ideas."
        );
        return;
      }

      designButton.disabled = true;
      const oldText = designButton.innerHTML;
      designButton.innerHTML =
        '<span class="icon">‚è≥</span><span>Designing‚Ä¶</span>';

      try {
        const resp = await callJson("/api/design-idea", {
          type,
          url,
          label,
          price,
        });
        if (!resp.success) throw new Error("API error");
        designOutput.value = resp.design || "";
      } catch (err) {
        console.error(err);
        alert("Error generating a design idea. Try again.");
      } finally {
        designButton.disabled = false;
        designButton.innerHTML = oldText;
      }
    });

    function openObjectionModal() {
      objectionModal.classList.remove("hidden");
      if (!objectionMessages.length) {
        renderObjectionChat();
      }
      setTimeout(() => {
        objectionInput.focus();
      }, 50);
    }

    function closeObjectionModal() {
      objectionModal.classList.add("hidden");
    }

    objectionLauncher.addEventListener("click", openObjectionModal);
    objectionCloseButton.addEventListener("click", closeObjectionModal);
    objectionModal.addEventListener("click", (e) => {
      if (e.target === objectionModal) closeObjectionModal();
    });

    function sendObjection() {
      const text = (objectionInput.value || "").trim();
      if (!text) {
        alert("Type the customer‚Äôs objection or your question first.");
        return;
      }

      const label = safeTrim(vehicleLabelInput.value) || "this vehicle";
      const price =
        safeTrim(priceInfoInput.value) || "Message for current pricing";

      objectionMessages.push({ role: "user", content: text });
      renderObjectionChat();
      objectionInput.value = "";

      objectionSendButton.disabled = true;
      const oldText = objectionSendButton.innerHTML;
      objectionSendButton.innerHTML = "<span>‚è≥ Coaching‚Ä¶</span>";

      callJson("/api/objection-coach", {
        messages: objectionMessages,
        label,
        price,
      })
        .then((resp) => {
          if (!resp.success) throw new Error("API error");
          const reply = resp.reply || "";
          objectionMessages.push({ role: "assistant", content: reply });
          renderObjectionChat();
        })
        .catch((err) => {
          console.error(err);
          alert("Error generating a response. Try again.");
        })
        .finally(() => {
          objectionSendButton.disabled = false;
          objectionSendButton.innerHTML = oldText;
        });
    }

    objectionSendButton.addEventListener("click", sendObjection);
    objectionInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && (e.metaKey || e.ctrlKey)) {
        e.preventDefault();
        sendObjection();
      }
    });

    // CALCULATOR MODAL OPEN/CLOSE
    function openCalcModal() {
      calcModal.classList.remove("hidden");
    }
    function closeCalcModal() {
      calcModal.classList.add("hidden");
    }
    calcLauncher.addEventListener("click", openCalcModal);
    calcCloseButton.addEventListener("click", closeCalcModal);
    calcModal.addEventListener("click", (e) => {
      if (e.target === calcModal) closeCalcModal();
    });

    // CALCULATOR LOGIC
    function fmtMoney(n) {
      return "$" + (n || 0).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // Payment
    document
      .getElementById("paymentForm")
      .addEventListener("submit", (e) => {
        e.preventDefault();
        const price = Number(
          document.getElementById("payPrice").value || 0
        );
        const down = Number(
          document.getElementById("payDown").value || 0
        );
        const term = Number(
          document.getElementById("payTerm").value || 0
        );
        const apr = Number(
          document.getElementById("payApr").value || 0
        );

        const principal = Math.max(price - down, 0);
        const r = apr > 0 ? apr / 100 / 12 : 0;
        let payment = 0;

        if (!term || !principal) {
          document.getElementById("payResult").textContent =
            "Missing info";
          return;
        }

        if (r === 0) {
          payment = principal / term;
        } else {
          const pow = Math.pow(1 + r, term);
          payment = (r * pow * principal) / (pow - 1);
        }

        document.getElementById("payResult").textContent =
          fmtMoney(payment) + " / mo";
      });

    // Affordability
    document
      .getElementById("affordForm")
      .addEventListener("submit", (e) => {
        e.preventDefault();
        const budget = Number(
          document.getElementById("affBudget").value || 0
        );
        const term = Number(
          document.getElementById("affTerm").value || 0
        );
        const apr = Number(
          document.getElementById("affApr").value || 0
        );

        const r = apr > 0 ? apr / 100 / 12 : 0;
        let principal = 0;

        if (!budget || !term) {
          document.getElementById("affResult").textContent =
            "Max price: $0";
          return;
        }

        if (r === 0) {
          principal = budget * term;
        } else {
          const pow = Math.pow(1 + r, term);
          principal = (budget * (pow - 1)) / (r * pow);
        }

        document.getElementById("affResult").textContent =
          "Max price: " + fmtMoney(principal);
      });

    // Income builder
    document
      .getElementById("incomeForm")
      .addEventListener("submit", (e) => {
        e.preventDefault();
        const goal = Number(
          document.getElementById("incGoal").value || 0
        );
        const perDeal = Number(
          document.getElementById("incPerDeal").value || 0
        );
        const days = Number(
          document.getElementById("incDays").value || 0
        );
        const closeRate = Number(
          document.getElementById("incClose").value || 0
        );

        if (!goal || !perDeal || !days || !closeRate) {
          document.getElementById("incResult").textContent =
            "Fill all fields.";
          return;
        }

        const dealsPerMonth = goal / perDeal;
        const dealsPerDay = dealsPerMonth / days;
        const showsPerDay = dealsPerDay / (closeRate / 100 || 1);
        const apptsPerDay = showsPerDay * 1.3;

        document.getElementById("incResult").textContent =
          "Deals/mo: " +
          dealsPerMonth.toFixed(1) +
          " ¬∑ Deals/day: " +
          dealsPerDay.toFixed(2) +
          " ¬∑ Shows/day: " +
          showsPerDay.toFixed(2) +
          " ¬∑ Appts/day: " +
          apptsPerDay.toFixed(2);
      });

    renderObjectionChat();
  </script>
</body>
</html>
